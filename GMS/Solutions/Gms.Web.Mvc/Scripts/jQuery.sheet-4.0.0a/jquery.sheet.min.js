var jQuery=window.jQuery||{};var Sheet=(function(i,n,k,m,o,l,g,c,q,j){var h=h||{};h.ActionUI=(function(r,u,s,t,v){var w=function(E,K,B,F,y,M){this.enclosure=E;this.pane=K;this.sheet=B;this.max=M;this.xIndex=0;this.yIndex=0;this.scrollAxis={x:{},y:{}};this.scrollSize={};this.hiddenColumns=[];this.hiddenRows=[];if(!(this.frozenAt=y)){this.frozenAt={row:0,col:0}}this.frozenAt.row=s.max(this.frozenAt.row,0);this.frozenAt.col=s.max(this.frozenAt.col,0);this.scrolledArea={start:{row:s.max(this.frozenAt.row,1),col:s.max(this.frozenAt.col,1)},end:{row:s.max(this.frozenAt.row,1),col:s.max(this.frozenAt.col,1)}};if(h.ActionUI.prototype.nthCss===null){if(M){h.ActionUI.prototype.nthCss=function(R,Y,T,V,U){var W=[],S=T.length,X=this.repeat;U=U||"{display: none;}";do{if(T[S]>V){W.push(Y+" "+R+":first-child"+X("+"+R,T[S]-1))}}while(S--);if(W.length){return W.join(",")+U}return""}}else{h.ActionUI.prototype.nthCss=function(R,X,T,V,U){var W=[],S=T.length;U=U||"{display: none;}";do{if(T[S]>V){W.push(X+" "+R+":nth-child("+T[S]+")")}}while(S--);if(W.length){return W.join(",")+U}return""}}}var D=this,H="#"+B.getAttribute("id"),P=this.scrollUI=K.scrollOuter=r.createElement("div"),O=K.scrollInner=r.createElement("div"),A=K.scrollStyleX=this.scrollStyleX=new h.StyleUpdater(function(R,S){R=R||[];if(R.length!==D.xIndex||S){D.xIndex=R.length||D.xIndex;S=S||C("col",H,R,D.frozenAt.col+1)+C("td",H+" tr",R,D.frozenAt.col+1);this.setStyle(S);if(R.length){D.scrolledArea.start.col=s.max(R.pop()||1,1);D.scrolledArea.end.col=s.max(R.shift()||1,1)}return true}return false}),z=K.scrollStyleY=this.scrollStyleY=new h.StyleUpdater(function(R,S){R=R||[];if(R.length!==D.yIndex||S){D.yIndex=R.length||D.yIndex;S=S||C("tr",H,R,D.frozenAt.row+1);this.setStyle(S);if(R.length){D.scrolledArea.start.row=s.max(R.pop()||1,1);D.scrolledArea.end.row=s.max(R.shift()||1,1)}return true}return false}),C=this.nthCss;P.setAttribute("class",F);P.appendChild(O);v(P).disableSelectionSpecial();K.appendChild(A.styleElement);K.appendChild(z.styleElement);var N,Q,J,I,G,L,x=B.tBody.children[0];K.resizeScroll=function(R){if(R){N=A.getStyle();Q=z.getStyle()}else{N=(B.clientWidth<=E.clientWidth?"":A.getStyle());Q=(B.clientHeight<=E.clientHeight?"":z.getStyle())}A.update(null," ");z.update(null," ");J=(x.clientWidth||B.clientWidth)+"px";I=B.clientHeight+"px";G=E.clientWidth+"px";L=E.clientHeight+"px";O.style.width=J;O.style.height=I;P.style.width=G;P.style.height=L;D.scrollStart("x");D.scrollStart("y");A.update(null,N);z.update(null,Q);if(K.inPlaceEdit){K.inPlaceEdit.goToTd()}};new MouseWheel(K,P)};w.prototype={putTdInView:function(E){var A=0,z=0,D=0,C,B;this.xIndex=0;this.yIndex=0;while((C=this.directionToSeeTd(E))!==null){B=this.scrolledArea.end;if(C.left){z--;this.scrollTo({axis:"x",value:B.col-1})}else{if(C.right){z++;this.scrollTo({axis:"x",value:B.col+1})}}if(C.up){D--;this.scrollTo({axis:"y",value:B.row-1})}else{if(C.down){D++;this.scrollTo({axis:"y",value:B.row+1})}}A++;if(A<25){break}}this.scrollStop()},directionToSeeTd:function(y){var x=this.pane,H={top:0,bottom:x.clientHeight,left:0,right:x.clientWidth},D=y.clientWidth,B=y.clientHeight,F={top:y.offsetTop,bottom:y.offsetTop+B,left:y.offsetLeft,right:y.offsetLeft+D},z=y.parentNode,E=this.scrolledArea.end;if(!y.col){return null}var G=y.barTop.cellIndex<E.col,A=z.rowIndex<E.row,C={up:A,down:F.bottom>H.bottom&&B<=x.clientHeight,left:G,right:F.right>H.right&&D<=x.clientWidth};if(C.up||C.down||C.left||C.right){return C}return null},repeat:function(z,y){var x="";while(y>0){if(y&1){x+=z}y>>=1;z+=z}return x},nthCss:null,redraw:function(){var x=this.pane.style;x.opacity=0.9999;setTimeout(function(){x.opacity=1},0)},hide:function(y,F,I,A){var D=this,E="#"+this.sheet.getAttribute("id"),H=this.toggleHideStyleX=new h.StyleUpdater(function(){var J=x("col",E,D.hiddenColumns,0)+x("td",E+" tr",D.hiddenColumns,0);this.setStyle(J)}),G=this.toggleHideStyleY=new h.StyleUpdater(function(){var J=x("tr",E,D.hiddenRows,0);this.setStyle(J)}),C,B,x=this.nthCss,z=this.pane;z.appendChild(H.styleElement);z.appendChild(G.styleElement);this.hiddenRows=[];this.hiddenColumns=[];if(y){C=y.length-1;if(C>-1){do{B=y[C];this.toggleHideRow(I[B],B)}while(C--)}}if(F){C=F.length-1;if(C>-1){do{B=F[C];this.toggleHideColumn(A[B],B)}while(C--)}}},remove:function(){},scrollStart:function(C){var D=this.pane,A=D.scrollOuter,B=this.scrollAxis[C],z=this.scrollSize=this.sheet.size();B.v=[];B.name=C;switch(C||"x"){case"x":B.value=0;B.max=z.cols;B.min=0;B.size=z.cols;D.scrollStyleX.update();B.scrollStyle=D.scrollStyleX;B.area=A.scrollWidth-A.clientWidth;B.sheetArea=D.table.clientWidth-D.table.corner.clientWidth;B.scrollUpdate=function(){A.scrollLeft=(B.value)*(B.area/B.size)};B.gridSize=100/B.size;break;case"y":B.value=0;B.max=z.rows;B.min=0;B.size=z.rows;D.scrollStyleY.update();B.scrollStyle=D.scrollStyleY;B.area=A.scrollHeight-A.clientHeight;B.sheetArea=D.table.clientHeight-D.table.corner.clientHeight;B.scrollUpdate=function(){A.scrollTop=(B.value)*(B.area/B.size)};B.gridSize=100/B.size;break}var y=B.max;do{var x=new t(B.gridSize*y);x.index=y+1;B.v.unshift(x)}while(y--)},scrollTo:function(A){A=A||{};A.axis=A.axis||"x";A.value=A.value||0;A.pixel=A.pixel||0;if(!this.scrollAxis){this.scrollStart(A.axis)}var z=this.scrollAxis[A.axis];if(!A.value){A.value=f.closest(z.v,s.abs(A.pixel/z.area)*100,z.min).index}A.max=A.max||z.max;var y=((A.value>A.max?A.max:A.value)-z.min),x=[];if(y>=0){do{x.push(y+z.min)}while(y-->0)}z.value=A.value;if(x.length){if(z.scrollStyle){return z.scrollStyle.update(x)}}else{if(z.scrollStyle){return z.scrollStyle.update()}}return false},scrollStop:function(){if(this.scrollAxis.x.scrollUpdate){this.scrollAxis.x.scrollUpdate()}if(this.scrollAxis.y.scrollUpdate){this.scrollAxis.y.scrollUpdate()}},toggleHideRow:function(z,y){var x=v(z);y=s.max(y+1,1);if(x.length&&v.inArray(y,this.hiddenRows)<0){this.hiddenRows.push(y)}else{this.hiddenRows.splice(this.hiddenRows.indexOf(y),1)}this.toggleHideStyleY.update()},rowShowAll:function(){v.each(this.hiddenRows||[],function(x){v(this).removeData("hidden")});this.toggleHideStyleY.setStyle("");this.hiddenRows=[]},toggleHideColumn:function(x,y){var z=v(x);y=s.max(y+1,1);if(z.length&&v.inArray(y,this.hiddenColumns)<0){this.hiddenColumns.push(y)}else{this.hiddenColumns.splice(this.hiddenColumns.indexOf(y),1)}this.toggleHideStyleX.update()},columnShowAll:function(){this.toggleHideStyleX.setStyle("");this.hiddenColumns=[]}};return w})(n,k,c,l,i);h.StyleUpdater=(function(r){function s(t){var u=this.styleElement=r.createElement("style");u.styleUpdater=this;this.update=t}if(r.createElement("style").styleSheet){s.prototype={setStyle:function(u){var v=this.styleElement,t=v.styleSheet;t.disabled=false;if(!t.disabled){t.cssText=u}},getStyle:function(){var u=this.styleElement,t=u.styleSheet;t.disabled=false;if(!t.disabled){return t.cssText}return""}}}else{s.prototype={setStyle:function(t){this.styleElement.innerHTML=t},getStyle:function(){return this.styleElement.innerHTML}}}return s})(n);i.fn.extend({sheet:function(s){var t=isNaN,r=i.sheet.events;s=s||{};i(this).each(function(){var A=Globalize,x=i(this),z={editable:true,editableNames:true,barMenus:true,freezableCells:true,allowToggleState:true,menuLeft:null,menuRight:null,newColumnWidth:120,title:null,calcOff:false,lockFormulas:false,parent:x,colMargin:18,boxModelCorrection:2,formulaFunctions:{},formulaVariables:{},cellSelectModel:"excel",autoAddCells:true,resizableCells:true,resizableSheet:true,autoFiller:true,minSize:{rows:1,cols:1},error:function(B){return B.error},endOfNumber:false,encode:function(B){switch(typeof B){case"object":if(B.getMonth){return A.format(B,"d")}return B}if(!B){return B||""}if(!B.replace){return B||""}return B.replace(/&/gi,"&amp;").replace(/>/gi,"&gt;").replace(/</gi,"&lt;").replace(/\n/g,"\n<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp ").replace(/  /g,"&nbsp; ")},frozenAt:[],contextmenuTop:{"Toggle freeze columns to here":function(D){var B=D.getTdLocation(D.obj.tdActive()).col,C=D.obj.pane().actionUI;C.frozenAt.col=(C.frozenAt.col==B?0:B)},"Insert column after":function(B){B.controlFactory.addColumn(B.colLast);return false},"Insert column before":function(B){B.controlFactory.addColumn(B.colLast,true);return false},"Add column to end":function(B){B.controlFactory.addColumn();return false},"Delete this column":function(B){B.deleteColumn();return false},"Hide column":function(B){B.toggleHideColumn();return false}},contextmenuLeft:{"Toggle freeze rows to here":function(C){var D=C.getTdLocation(C.obj.tdActive()).row,B=C.obj.pane().actionUI;B.frozenAt.row=(B.frozenAt.row==D?0:D)},"Insert row after":function(B){B.controlFactory.addRow(B.rowLast);return false},"Insert row before":function(B){B.controlFactory.addRow(B.rowLast,true);return false},"Add row to end":function(B){B.controlFactory.addRow();return false},"Delete this row":function(B){B.deleteRow();return false},"Hide row":function(B){B.toggleHide.row();return false}},contextmenuCell:{Copy:false,Cut:false,"Insert column after":function(B){B.controlFactory.addColumn(B.colLast);return false},"Insert column before":function(B){B.controlFactory.addColumn(B.colLast,true);return false},"Add column to end":function(B){B.controlFactory.addColumn();return false},"Delete this column":function(B){B.deleteColumn();return false},line1:"line","Insert row after":function(B){B.controlFactory.addRow(B.rowLast);return false},"Insert row before":function(B){B.controlFactory.addRow(B.rowLast,true);return false},"Add row to end":function(B){B.controlFactory.addRow();return false},"Delete this row":function(B){B.deleteRow();return false},line2:"line","Add spreadsheet":function(B){B.addSheet()},"Delete spreadsheet":function(B){B.deleteSheet()}},hiddenRows:[],hiddenColumns:[],cellStartingHandlers:{"$":function(C,B){return e.DOLLAR.call(this,C.substring(1).replace(A.culture().numberFormat[","],""),2,B||"$")},"£":function(B){return y.s.cellStartingHandlers["$"].call(this,B,"£")}},cellEndHandlers:{"%":function(B){return B.substring(0,this.value.length-1)/100}},cellTypeHandlers:{percent:function(D){var C=(t(D)?A.parseFloat(D):D*1),B;if(!t(C)){B=new l(C);B.html=A.format(C,"p");return B}return D},date:function(C){var B=A.parseDate(C);B.html=A.format(B,"d");return B},time:function(C){var B=A.parseDate(C);B.html=A.format(B,"t");return B},currency:function(D){var C=(t(D)?A.parseFloat(D):D*1),B;if(!t(C)){B=new l(C);B.html=A.format(C,"c");return B}return D},number:function(D){var C,B;if(!s.endOfNumber){C=A.culture().numberFormat["."];s.endOfNumber=new q("(["+(C=="."?".":C)+"])([0-9]*?[1-9]+)?(0)*$")}if(!t(D)){B=new l(D);B.html=A.format(D+"","n10").replace(s.endOfNumber,function(G,F,E){return(E?F:"")+(E||"")});return B}return D}},alert:function(B){alert(B)},prompt:function(C,D,B){D(prompt(C,B))},confirm:function(D,B,C){if(confirm(D)){B()}else{if(C){C()}}},initCalcRows:40,initCalcCols:20};var y=this.jS;if(y){var v=x.children().detach();y.kill();x.html(v);for(var w in r){if(s[r[w]]){x.unbind(r[w])}}}if((this.className||"").match(/\bnotEditable\b/i)!=null){s.editable=false}for(var u in r){if(s[r[u]]){x.bind(r[u],s[r[u]])}}if(!i.sheet.instance.length){i.sheet.instance=[]}this.jS=y=i.sheet.createInstance(i.extend(z,s),i.sheet.instance.length);i.sheet.instance.push(y)});return this},disableSelectionSpecial:function(){this.each(function(){this.onselectstart=function(){return false};this.unselectable="on";this.style["-moz-user-select"]="none"});return this},getSheet:function(){var r=this[0],s=(r.jS||{});return s},getCellValue:function(w,s,r){var t=this[0],u=(t.jS||{});r=(r||0);if(u.updateCellValue){try{return u.updateCellValue(r,w,s)}catch(v){}}return null},setCellValue:function(w,y,t,s){var u=this[0],v=(u.jS||{}),r;s=(s||0);if(v.getCell&&(r=v.getCell(y,t,s))){try{if((w+"").charAt(0)=="="){r.valueOverride=r.value="";r.formula=w.substring(1)}else{r.value=w;r.valueOverride=r.formula=""}r.calcLast=r.calcDependenciesLast=0;v.updateCellValue.call(r);v.updateCellDependencies.call(r);return true}catch(x){}}return false},setCellFormula:function(y,x,t,s){var u=this[0],v=(u.jS||{}),r;s=(s||0);if(v.getCell&&(r=v.getCell(x,t,s))){try{r.formula=y;r.valueOverride=r.value="";r.calcLast=r.calcDependenciesLast=0;v.updateCellValue(s,x,t)}catch(w){}}return this},setCellHtml:function(u,y,t,s){var v=this[0],w=(v.jS||{}),r;s=(s||0);if(w.getCell&&(r=w.getCell(y,t,s))){try{r.html=[u];r.calcLast=r.calcDependenciesLast=0;w.updateCellValue(s,y,t)}catch(x){}}return this},isSheetFullScreen:function(){var r=this[0],s=(r.jS||{});if(s.obj){return s.obj.fullScreen().is(":visible")}return false},serializeCellInputs:function(s){var t=this[0],u=(t.jS||{}),r=u.obj.tables().find(":input");if(s){return r.serializeArray()}else{return r.serialize()}},viewSource:function(r){var s="";i(this).each(function(){if(r){s+=i(this).toPrettySource()}else{s+=i(this).toCompactSource()}});i.print(s);return s},toCompactSource:function(){var v=this[0];var s="";if(v.nodeType==1){s+="<"+v.tagName.toLowerCase();var x=v.attributes.length;for(var u=0;u<x;u++){var t=v.attributes[u].name,w=v.getAttribute(t);if(w){if(t=="contentEditable"&&w=="inherit"){continue}if(typeof(w)=="string"){s+=" "+t+'="'+w.replace(/"/g,"'")+'"'}else{if(t=="style"&&w.cssText){s+=' style="'+w.cssText+'"'}}}}if(v.tagName=="COL"){s+="/>"}else{s+=">";var r="";i(v.childNodes).each(function(){r+=i(this).toCompactSource()});s+=r;s+="</"+v.tagName.toLowerCase()+">"}}else{if(v.nodeType==3){s+=v.data.replace(/^\s*(.*)\s*$/g,"$1")}}return s},toPrettySource:function(w){var v=this[0],y,u;w=w||"";var s="";if(v.nodeType==1){s+="\n"+w+"<"+v.tagName.toLowerCase();y=v.attributes.length;for(u=0;u<y;u++){var t=v.attributes[u].name,x=v.getAttribute(t);if(x){if(t=="contentEditable"&&x=="inherit"){continue}if(typeof(x)=="string"){s+=" "+t+'="'+i.trim(x.replace(/"/g,"'"))+'"'}else{if(t=="style"&&x.cssText){s+=' style="'+i.trim(x.cssText)+'"'}}}}if(v.childNodes.length<=0){if(v.tagName=="COL"){s+="/>"}else{s+="></"+v.tagName.toLowerCase()+">"}}else{s+=">";var r="";y=v.childNodes.length;for(u=0;u<y;u++){r+=i(v.childNodes[u]).toPrettySource(w+"  ")}s+=r;if(r.indexOf("\n")>=0){s+="\n"+w}s+="</"+v.tagName.toLowerCase()+">"}}else{if(v.nodeType==3){s+=v.data.replace(/^\s*(.*)\s*$/g,"$1")}}return s}});i.sheet={instance:[],dependencies:{coreCss:{css:"jquery.sheet.css"},formulaParser:{script:"parser/formula/formula.js"},tsvParser:{script:"parser/tsv/tsv.js"},jQueryUI:{script:"jquery-ui/jquery-ui.min.js",thirdParty:true},jQueryUIThemeRoller:{css:"jquery-ui/themes/smoothness/jquery-ui.min.css",thirdParty:true},globalize:{script:"globalize/lib/globalize.js",thirdParty:true},nearest:{script:"jquery-nearest/src/jquery.nearest.min.js",thirdParty:true},mousewheel:{script:"MouseWheel/MouseWheel.js",thirdParty:true}},optional:{advancedFn:{script:"plugins/jquery.sheet.advancedfn.js"},dts:{script:"plugins/jquery.sheet.dts.js"},financeFn:{script:"plugins/jquery.sheet.financefn.js"},colorPicker:{css:"really-simple-color-picker/colorPicker.css",script:"really-simple-color-picker/jquery.colorPicker.min.js",thirdParty:true},elastic:{script:"jquery-elastic/jquery.elastic.source.js",thirdParty:true},globalizeCultures:{script:"globalize/lib/cultures/globalize.cultures.js",thirdParty:true},raphael:{script:"raphael/raphael-min.js",thirdParty:true},gRaphael:{script:"graphael/g.raphael.js",thirdParty:true},gRaphaelBar:{script:"graphael/g.bar.js",thirdParty:true},gRaphaelDot:{script:"graphael/g.dot.js",thirdParty:true},gRaphaelLine:{script:"graphael/g.line.js",thirdParty:true},gRaphaelPie:{script:"graphael/g.pie.js",thirdParty:true},undoManager:{script:"Javascript-Undo-Manager/js/undomanager.js",thirdParty:true},zeroClipboard:{script:"zeroclipboard/dist/ZeroClipboard.min.js",thirdParty:true}},events:["sheetAddRow","sheetAddColumn","sheetSwitch","sheetRename","sheetTabSortStart","sheetTabSortUpdate","sheetCellEdit","sheetCellEdited","sheetCalculation","sheetAdd","sheetDelete","sheetDeleteRow","sheetDeleteColumn","sheetOpen","sheetAllOpened","sheetSave","sheetFullScreen","sheetFormulaKeydown"],preLoad:function(u,t){u=u||"";t=i.extend({skip:["globalizeCultures"],thirdPartyDirectory:"bower_components/"},t);var s=function(){if(this.script!==undefined){n.write('<script src="'+u+(this.thirdParty?t.thirdPartyDirectory:"")+this.script+'"><\/script>')}if(this.css!==undefined){n.write('<link rel="stylesheet" type="text/css" href="'+u+(this.thirdParty?t.thirdPartyDirectory:"")+this.css+'"></link>')}};for(var r in t.skip){if(this.dependencies[t.skip[r]]){delete this.dependencies[t.skip[r]]}if(this.optional[t.skip[r]]){delete this.optional[t.skip[r]]}}i.each(this.dependencies,function(){s.call(this)});i.each(this.optional,function(){s.call(this)})},createInstance:function(J,D){var H=this,z=function(I,s){var u=s.parentNode;if(u.lastchild==s){u.appendChild(I)}else{u.insertBefore(I,s.nextSibling)}},r=i(k),w=i(n),A=n.body,x=i(A),E=function(){},G=undefined,C=c,v=isNaN,F=NaN,t=function(s){this.cells=s||[]},B=t.prototype={clone:function(){var I=[];for(var u=0;u<this.cells.length;u++){var s=this.cells[u],K={value:s.value,formula:s.formula,td:s.td,dependencies:s.dependencies,needsUpdated:s.needsUpdated,calcCount:s.calcCount,sheet:s.sheet,calcLast:s.calcLast,html:s.html,state:s.state,jS:s.jS,calcDependenciesLast:s.calcDependenciesLast,style:s.style||s.td.attr("style")||"",cl:s.cl||s.td.attr("class")||""};I.push(K)}return new t(I)}},y={version:"4.x",i:0,I:D,sheetCount:0,spreadsheets:[],controls:{autoFiller:[],bar:{helper:[],corner:[],x:{controls:[],handleFreeze:[],menu:[],menuParent:[],parent:[],td:[],tds:function(){var u=i([]);for(var s in this.td[y.i]){u.pushStack(this.td[y.i][s])}return u}},y:{controls:[],handleFreeze:[],menu:[],parent:[],td:[],tds:function(){var u=i([]);for(var s in this.td[y.i]){u.pushStack(this.td[y.i][s])}return u}}},barMenuLeft:[],barMenuTop:[],barLeft:[],barTop:[],barTopParent:[],chart:[],tdMenu:[],cellsEdited:[],enclosure:[],enclosures:null,formula:null,fullScreen:null,header:null,inPlaceEdit:[],inputs:[],label:null,menuLeft:[],menuRight:[],menus:[],pane:[],panes:null,scrolls:null,sheetAdder:null,table:[],tables:null,tab:[],tabContainer:null,tabs:null,title:null,toggleHide:{x:[],y:[]},ui:null},obj:{autoFiller:function(){return y.controls.autoFiller[y.i]||i([])},barCorner:function(){return y.controls.bar.corner[y.i]||i([])},barHelper:function(){return y.controls.bar.helper[y.i]||(y.controls.bar.helper[y.i]=i([]))},barLeft:function(s){return(y.controls.bar.y.td[y.i]&&y.controls.bar.y.td[y.i][s]?y.controls.bar.y.td[y.i][s]:i([]))},barLeftControls:function(){return y.controls.bar.y.controls[y.i]||i([])},barLefts:function(){return y.controls.bar.y.tds()},barHandleFreezeLeft:function(){return y.controls.bar.y.handleFreeze[y.i]||i([])},barMenuLeft:function(){return y.controls.bar.y.menu[y.i]||i([])},barTop:function(s){return(y.controls.bar.x.td[y.i]&&y.controls.bar.x.td[y.i][s]?y.controls.bar.x.td[y.i][s]:i([]))},barTopControls:function(){return y.controls.bar.x.controls[y.i]||i([])},barTops:function(){return y.controls.bar.x.tds()},barTopParent:function(){return y.controls.bar.x.parent[y.i]||i([])},barHandleFreezeTop:function(){return y.controls.bar.x.handleFreeze[y.i]||i([])},barMenuParentTop:function(){return y.controls.bar.x.menuParent[y.i]||i([])},barMenuTop:function(){return y.controls.bar.x.menu[y.i]||i([])},tdActive:function(){return y.cellLast.td||i([])},tdMenu:function(){return y.controls.tdMenu[y.i]||i([])},cellsEdited:function(){return y.controls.cellsEdited[y.i]||i([])},chart:function(){return y.controls.chart[y.i]||i([])},enclosure:function(){return y.controls.enclosure[y.i]||i([])},enclosures:function(){return y.controls.enclosures||i([])},formula:function(){return y.controls.formula||i([])},fullScreen:function(){return y.controls.fullScreen||i([])},header:function(){return y.controls.header||i([])},highlighted:function(){return y.highlightedLast.obj||i([])},menuRight:function(){return y.controls.menuRight[y.i]||i([])},inPlaceEdit:function(){return y.controls.inPlaceEdit[y.i]||i([])},inputs:function(){return y.controls.inputs[y.i]||i([])},label:function(){return y.controls.label||i([])},menus:function(){return y.controls.menus[y.i]||i([])},menuLeft:function(){return y.controls.menuLeft[y.i]||i([])},pane:function(){return y.controls.pane[y.i]||{}},panes:function(){return y.controls.panes||i([])},parent:function(){return J.parent},scrolls:function(){return y.controls.scrolls||i([])},sheetAdder:function(){return y.controls.sheetAdder||i([])},table:function(){return y.controls.table[y.i]||i([])},tables:function(){return y.controls.tables||i([])},tab:function(){return y.controls.tab[y.i]||i([])},tabs:function(){return y.controls.tabs||i([])},tabContainer:function(){return y.controls.tabContainer||i([])},title:function(){return y.controls.title||i([])}},id:"jS_"+D+"_",cl:{autoFiller:"jSAutoFiller",autoFillerHandle:"jSAutoFillerHandle",autoFillerCover:"jSAutoFillerCover",barCorner:"jSBarCorner",barController:"jSBarController",barHelper:"jSBarHelper",barLeft:"jSBarLeft",barHandleFreezeLeft:"jSBarHandleFreezeLeft",barTop:"jSBarTop",barTopMenuButton:"jSBarTopMenuButton",barHandleFreezeTop:"jSBarHandleFreezeTop",barTopParent:"jSBarTopParent",chart:"jSChart",formula:"jSFormula",formulaParent:"jSFormulaParent",header:"jSHeader",fullScreen:"jSFullScreen",inPlaceEdit:"jSInPlaceEdit",menu:"jSMenu",menuFixed:"jSMenuFixed",parent:"jSParent",scroll:"jSScroll",sheetAdder:"jSSheetAdder",table:"jS",label:"jSLoc",pane:"jSEditPane",tab:"jSTab",tabContainer:"jSTabContainer",tdMenu:"jSTdMenu",title:"jSTitle",enclosure:"jSEnclosure",ui:"jSUI",uiAutoFiller:"ui-state-active",uiBar:"ui-widget-header",uiBarHighlight:"ui-state-active",uiBarHandleFreezeLeft:"ui-state-default",uiBarHandleFreezeTop:"ui-state-default",uiBarMenuTop:"ui-state-default",uiTdActive:"ui-state-active",uiTdHighlighted:"ui-state-highlight",uiControl:"ui-widget-header ui-corner-top",uiControlTextBox:"ui-widget-content",uiFullScreen:"ui-widget-content ui-corner-all",uiInPlaceEdit:"ui-state-highlight",uiMenu:"ui-widget-header",uiMenuUl:"ui-widget-header",uiMenuLi:"ui-widget-header",uiPane:"ui-widget-content",uiParent:"ui-widget-content ui-corner-all",uiTable:"ui-widget-content",uiTab:"ui-widget-header",uiTabActive:"ui-state-highlight"},msg:{addRowMulti:"How many rows would you like to add?",addColumnMulti:"How many columns would you like to add?",cellFind:"What are you looking for in this spreadsheet?",cellNoFind:"No results found.",dragToFreezeCol:"Drag to freeze column",dragToFreezeRow:"Drag to freeze row",addSheet:"Add a spreadsheet",openSheet:"Are you sure you want to open a different sheet?  All unsaved changes will be lost.",toggleHideRow:"No row selected.",toggleHideColumn:"No column selected.",loopDetected:"Loop Detected",newSheetTitle:"What would you like the sheet's title to be?",notFoundColumn:"Column not found",notFoundRow:"Row not found",notFoundSheet:"Sheet not found",setCellRef:"Enter the name you would like to reference the cell by.",sheetTitleDefault:"Spreadsheet {index}",maxRowsBrowserLimitation:"You've reached the maximum amount of rows this browser supports. Try using Chrome, FireFox, or Internet Explorer 9+",maxColsBrowserLimitation:"You've reached the maximum amount of columns this browser supports. Try using Chrome, FireFox, or Internet Explorer 9+",maxSizeBrowserLimitationOnOpen:"The spreadsheet you are loading is larger than the maximum size of cells this browser supports. Try using Chrome, Firefox, or Internet Explorer 9+. You can an proceed, but the spreadsheet may not work as intended."},kill:function(){if(!y){return false}i(n).unbind("keydown");this.obj.fullScreen().remove();(this.obj.inPlaceEdit().destroy||E)();J.parent.trigger("sheetKill").removeClass(y.cl.uiParent).html("");J.parent[0].jS=G;this.obj.menus().remove();var s=i.sheet.events.length;for(var u=0;u<s;u++){J.parent.unbind(i.sheet.events[u])}i.sheet.instance.splice(D,1);return true},trigger:function(s,u){u=u||[];return J.parent.triggerHandler(s,[y].concat(u))},spreadsheetsToArray:function(s){if(s||y.spreadsheets.length==0){y.cycleCellsAll(function(I,K,u){y.createCell(I,K,u)})}return y.spreadsheets},spreadsheetToArray:function(u,s){s=(s?s:y.i);if(!y.spreadsheets[s]){y.cycleCells(function(K,L,I){y.createCell(K,L,I)})}return y.spreadsheets[s]},createCell:function(N,Q,S,V,U,Y){var I,O,R,u,X,T,K,L,s,P,M,Z,W;if(!(I=y.spreadsheets[N])){I=y.spreadsheets[N]=[]}if(!(O=I[Q])){O=I[Q]=[]}if(!(X=y.controls.tables[N])){return{}}if(!(L=X.tBody)){return{}}if(!(s=L.children[Q])){return{}}if(!(P=s.children[S])){return{}}M=i(P);R=O[S]=P.jSCell={td:M,dependencies:[],formula:P.getAttribute("data-formula")||"",cellType:P.getAttribute("data-celltype")||null,value:P.textContent||P.innerText||"",calcCount:V||0,calcLast:U||-1,calcDependenciesLast:Y||-1,sheet:N,type:"cell",jS:y,state:[],needsUpdated:true,uneditable:P.getAttribute("data-uneditable")||false};if(R.formula&&R.formula.charAt(0)=="="){R.formula=R.formula.substring(1)}T=X.colGroup;while(!(K=T.children[S])){K=n.createElement("col");K.setAttribute("style","width:"+y.s.newColumnWidth+"px;");T.appendChild(K)}if(!(u=K.jSCells)){u=K.jSCells=[]}u.unshift(R);if(!K.tds){K.tds=[]}K.tds.unshift(P);P.col=K;P.type="cell";P.barLeft=s.children[0];P.barTop=L.children[0].children[S];if(!s.jSCells){s.jSCells=[]}s.jSCells.unshift(R);if(!s.tds){s.tds=[]}s.tds.unshift(P);if(!X.jSCells){X.jSCells=[]}X.jSCells.unshift(R);if(!X.tds){X.tds=[]}X.tds.unshift(P);P.table=X;if(!(W=y.controls.bar.y.td[N])){W=y.controls.bar.y.td[N]=[]}if(!W[Q]){W[Q]=i(s.children[0])}if(!(Z=y.controls.bar.x.td[N])){Z=y.controls.bar.x.td[N]=[]}if(!Z[S]){Z[S]=i(L.children[0].children[S])}return R},getCell:function(M,K,I){var u,L,s;I=(I||0);if(y.spreadsheets&&(u=y.spreadsheets[I])&&(L=u[M])&&(s=L[K])){return s}return null},nav:false,setNav:function(I){var s=i.sheet.instance;for(var u=0;u<s.length;u++){(s[u]||{}).nav=false}y.nav=I},controlFactory:{addRowMulti:function(I,L,u,s){function K(M){if(M){if(!v(M)){y.controlFactory.addCells(I,u,parseInt(M),"row",s);y.trigger("sheetAddRow",[I,u,M])}}}if(!L){J.prompt(y.msg.addRowMulti,K)}else{K(L)}},addColumnMulti:function(I,L,u,s){function K(M){if(M){if(!v(M)){y.controlFactory.addCells(I,u,parseInt(M),"col",s);y.trigger("sheetAddColumn",[I,u,M])}}}if(!L){J.prompt(y.msg.addColumnMulti,K)}else{K(L)}},addCells:function(R,P,W,V,L){y.autoFillerHide();y.setDirty(true);y.setChanged(true);y.obj.barHelper().remove();var T=y.obj.table(),U=T[0],s=y.sheetSize(U),Q=false,N=y.obj.tdActive(),I;W=W||1;V=V||"col";if(R==G){R=(V=="row"?s.rows:s.cols);Q=true}switch(V){case"row":if(i.sheet.max){if(i.sheet.max>s.rows&&i.sheet.max<=s.rows+W){W=i.sheet.max-s.rows}else{if(i.sheet.max&&i.sheet.max<=s.rows+W){if(!y.isBusy()){J.alert(y.msg.maxRowsBrowserLimitation)}return false}}}I={el:function(){var X=y.rowTds(U,R);if(!X||!X[0]){return[]}return[X[0].parentNode]},size:function(){if(!I.Size){var X=I.el()[0];I.Size=X.children.length-1}return I.Size},loc:function(){var X=I.el();return y.getTdLocation(X[0].children)},trs:[],newObj:function(){var X=I.size(),Z=n.createElement("tr");Z.setAttribute("style","height: "+J.colMargin+"px;");for(var Y=0;Y<=X;Y++){var aa=n.createElement("td");if(Y==0){aa.setAttribute("class",y.cl.barLeft+" "+y.cl.uiBar);aa.entity="left";aa.type="bar"}Z.appendChild(aa)}I.trs.push(Z);return Z},offset:{row:W,col:0},start:function(){return{row:(P?R:R+W)}},createCells:function(){for(var Z=0;Z<I.trs.length;Z++){var Y=(P?0:1)+R;y.spreadsheets[y.i].splice(Z+Y,0,[]);for(var X=0;X<I.trs[Z].children.length;X++){if(X==0){y.controls.bar.y.td[y.i].splice(Z+Y,0,i(I.trs[Z].children[X]))}else{y.createCell(y.i,Z+Y,X)}}}y.refreshRowLabels(R)}};break;case"col":if(i.sheet.max){if(i.sheet.max>s.cols&&i.sheet.max<=s.cols+W){W=i.sheet.max-s.cols}else{if(i.sheet.max&&i.sheet.max<=s.cols+W){if(!y.isBusy()){J.alert(y.msg.maxColsBrowserLimitation)}return false}}}I={el:function(){var Y=y.rowTds(U,1)[R],ab=y.rowTds(U),ac=ab[ab.length-1],aa=y.getTdLocation(ac),Z=[];for(var X=0;X<=aa.row;X++){Z.push(U.tBody.children[X].children[R])}return Z},col:function(){return y.col(U,R)},cols:[],newCol:function(){var X=n.createElement("col");X.setAttribute("style","width:"+y.s.newColumnWidth+"px;");I.cols.push(X);return X},loc:function(X){X=(X?X:I.el());return y.getTdLocation(X[0])},tds:[],newObj:function(){var X=n.createElement("td");I.tds.push(X);return X},offset:{row:0,col:W},start:function(){return{col:(P?R:R+W)}},createCells:function(){var Z=y.rows(U);for(var ab=0;ab<Z.length;ab++){var Y=(P?0:1)+R,ad=Y+W,X=0;for(Y;Y<ad;Y++){var ac=U.tBody.children[ab].children[Y],aa=i(ac);if(ab==0){y.controls.bar.x.td[y.i].splice(Y,0,aa);ac.innerText=d.columnLabelString(Y);ac.className=y.cl.barTop+" "+y.cl.uiBar;ac.type="bar";ac.entity="top";I.cols[X].setAttribute("style","width:"+y.s.newColumnWidth+"px;");I.cols[X].bar=ac;X++}else{y.spreadsheets[y.i][ab].splice(Y,0,{});y.createCell(y.i,ab,Y)}}}y.refreshColumnLabels(R)}};break}var u=I.el(),S=I.loc(u),K,O=u.length-1,M;if(P){do{M=W-1;do{u[O].parentNode.insertBefore(I.newObj(),u[O])}while(M--)}while(O--);if(I.newCol){K=I.col();M=W-1;do{K.parentNode.insertBefore(I.newCol(),K)}while(M--)}}else{do{M=W-1;do{z(I.newObj(),u[O])}while(M--)}while(O--);if(I.newCol){K=I.col();M=W-1;do{z(I.newCol(),K)}while(M--)}}I.createCells();if(!L&&Q!=true){y.offsetFormulas(S,I.offset,P)}y.obj.pane().resizeScroll(true);if(N&&N[0]&&N[0].cellIndex&&N[0].parentNode){y.colLast=N[0].cellIndex;y.rowLast=N[0].parentNode.rowIndex}return true},addRow:function(u,s){y.controlFactory.addCells(u,s,1,"row");y.trigger("sheetAddRow",[u,s,1])},addColumn:function(u,s){y.controlFactory.addCells(u,s,1,"col");y.trigger("sheetAddColumn",[u,s,1])},barLeft:function(u){var I=u.tBody.children,s=I.length-1;if(s>-1){do{I[s].insertBefore(n.createElement("td"),I[s].children[0])}while(s-->1)}},barTop:function(P){var s=P.colGroup,O=s.children,L,u=P.tBody.children[0],N=n.createElement("col"),K=n.createElement("td"),M=n.createElement("tr");while(O.length>u.children.length){s.removeChild(O[O.length-1])}N.width=J.colMargin+"px";N.style.width=N.width;s.insertBefore(N,s.children[0]);M.appendChild(K);M.className=y.cl.barTopParent;P.tBody.insertBefore(M,P.tBody.children[0]);P.barTopParent=M;P.corner=K;y.controls.barTopParent[y.i]=i(M);L=u.children.length-1;do{var I=n.createElement("td");if(!O[L]){O[L]=n.createElement("col");s.insertBefore(O[L],N.nextSibling)}O[L].bar=I;I.col=O[L];M.insertBefore(I,K.nextSibling)}while(L-->0);P.barTop=y.controls.barTopParent[y.i].children();return M},barHandleFreeze:{top:function(I){if(y.isBusy()){return false}var s=y.obj.pane().actionUI,R=s.frozenAt,O=s.scrolledArea;if(!(O.end.col<=R.col+1)){return false}y.obj.barHelper().remove();var N=y.obj.barTop(R.col+1),P=N.position(),Q,K=i(I).offset(),M=n.createElement("div"),u=I.freezeHandleTop=i(M).appendTo(I).addClass(y.cl.uiBarHandleFreezeTop+" "+y.cl.barHelper+" "+y.cl.barHandleFreezeTop).height(N.height()).css("left",(P.left-M.clientWidth)+"px").attr("title",y.msg.dragToFreezeCol),L=I.table.barTop;y.controls.bar.helper[y.i]=y.obj.barHelper().add(M);y.controls.bar.x.handleFreeze[y.i]=u;y.draggable(u,{axis:"x",start:function(){y.setBusy(true);Q=i(n.createElement("div")).appendTo(I).css("position","absolute").addClass("ui-state-highlight "+y.cl.barHelper).height(I.table.corner.clientHeight).fadeTo(0,0.33)},drag:function(){var S=y.nearest(u,L).prev();if(S.length&&S.position){Q.width(S.position().left+S.width())}},stop:function(U,S){Q.remove();y.setBusy(false);y.setDirty(true);var T=y.nearest(u,L);y.obj.barHelper().remove();O.end.col=s.frozenAt.col=y.getTdLocation(T).col-1;y.autoFillerHide();s.scrollStart("x",y.sheetSize(I.table))},containment:[K.left,K.top,C.min(K.left+I.table.clientWidth,K.left+I.clientWidth-k.scrollBarSize.width),K.top]});return true},left:function(I){if(y.isBusy()){return false}var I=y.obj.pane(),s=I.actionUI,R=s.frozenAt,O=s.scrolledArea;if(!(O.end.row<=(R.row+1))){return false}y.obj.barHelper().remove();var N=i(I.table.tBody.children[R.row+1].children[0]),P=N.position(),Q,K=i(I).offset(),M=n.createElement("div"),u=I.freezeHandleLeft=i(M).appendTo(I).addClass(y.cl.uiBarHandleFreezeLeft+" "+y.cl.barHelper+" "+y.cl.barHandleFreezeLeft).width(N.width()).css("top",(P.top-M.clientHeight)+"px").attr("title",y.msg.dragToFreezeRow),L=i(I.table.tBody.children);y.controls.bar.helper[y.i]=y.obj.barHelper().add(M);y.controls.bar.y.handleFreeze[y.i]=u;y.draggable(u,{axis:"y",start:function(){y.setBusy(true);Q=i(n.createElement("div")).appendTo(I).css("position","absolute").addClass("ui-state-highlight "+y.cl.barHelper).width(M.clientWidth).fadeTo(0,0.33)},drag:function(){var S=y.nearest(u,L).prev();if(S.length&&S.position){Q.height(S.position().top+S.height())}},stop:function(U,S){Q.remove();y.setBusy(false);y.setDirty(true);var T=y.nearest(u,L);y.obj.barHelper().remove();O.end.row=s.frozenAt.row=C.max(y.getTdLocation(T.children(0)).row-1,0);y.autoFillerHide();I.actionUI.scrollStart("y",y.sheetSize(I.table))},containment:[K.left,K.top,K.left,C.min(K.top+I.table.clientHeight,K.top+I.clientHeight-k.scrollBarSize.height)]});return true},corner:function(){}},menu:function(I,s){var L,u=i([]);switch(I){case"top":L=i(n.createElement("div")).addClass(y.cl.uiMenu+" "+y.cl.tdMenu);y.controls.bar.x.menu[y.i]=L;break;case"left":L=i(n.createElement("div")).addClass(y.cl.uiMenu+" "+y.cl.tdMenu);y.controls.bar.y.menu[y.i]=L;break;case"cell":L=i(n.createElement("div")).addClass(y.cl.uiMenu+" "+y.cl.tdMenu);y.controls.tdMenu[y.i]=L;break}y.controls.menus[y.i]=y.obj.menus().add(L);L.mouseleave(function(){L.hide()}).bind("contextmenu",function(){return false}).appendTo(x).hide().disableSelectionSpecial();for(var K in s){if(s[K]){if(i.isFunction(s[K])){u.pushStack(i(n.createElement("div")).text(K).data("msg",K).click(function(){s[i(this).data("msg")].call(this,y);L.hide();return false}).appendTo(L).hover(function(){u.removeClass("ui-state-highlight");i(this).addClass("ui-state-highlight")},function(){i(this).removeClass("ui-state-highlight")}))}else{if(s[K]=="line"){i(n.createElement("hr")).appendTo(L)}}}}return L},barMenu:{top:function(I,s,u){if(y.isBusy()){return false}var L=y.obj.barMenuTop().hide();if(!L.length){L=y.controlFactory.menu("top",J.contextmenuTop)}y.obj.menus().hide();if(!u){L.css("left",(I.pageX-5)+"px").css("top",(I.pageY-5)+"px").show();return L}var K=y.obj.barMenuParentTop().hide();if(!K.length){K=i(n.createElement("div")).addClass(y.cl.uiBarMenuTop+" "+y.cl.barHelper+" "+y.cl.barTopMenuButton).append(i(n.createElement("span")).addClass("ui-icon ui-icon-triangle-1-s")).mousedown(function(M){K.parent().mousedown().mouseup();var N=K.offset();L.css("left",(M.pageX-5)+"px").css("top",(M.pageY-5)+"px").show()}).blur(function(){if(L){L.hide()}}).bind("destroy",function(){K.remove();y.controls.bar.x.menuParent[y.i]=null});y.controls.bar.x.menuParent[y.i]=K}K.prependTo(u).show()},left:function(u,s){if(y.isBusy()){return false}y.obj.barMenuLeft().hide();if(s){y.obj.barHandleFreezeLeft().remove()}var I;I=y.obj.barMenuLeft();if(!I.length){I=y.controlFactory.menu("left",J.contextmenuLeft)}y.obj.menus().hide();I.css("left",(u.pageX-5)+"px").css("top",(u.pageY-5)+"px").show();return true},corner:function(){}},tdMenu:function(s){if(y.isBusy()){return false}y.obj.tdMenu().hide();var u=y.obj.tdMenu();if(!u.length){u=y.controlFactory.menu("cell",J.contextmenuCell)}y.obj.menus().hide();u.css("left",(s.pageX-5)+"px").css("top",(s.pageY-5)+"px").show();return true},header:function(){y.obj.header().remove();y.obj.sheetAdder().remove();y.obj.tabContainer().remove();var P=n.createElement("div"),I=n.createElement("table"),M=n.createElement("tr"),S,K,T=n.createElement("td"),U,L,u,Q,s;P.appendChild(I);I.appendChild(M);P.className=y.cl.header+" "+y.cl.uiControl;y.controls.header=i(P);if(J.title){if(i.isFunction(J.title)){J.title=y.title(y,D)}T.className=y.cl.title;y.controls.title=i(T).html(J.title)}else{i(T).hide()}M.appendChild(T);function R(W){if(i.isFunction(W)){W=i(W.call(y))}else{W=i(W)}if(W.is("ul")){W.find("ul").hide().addClass(y.cl.uiMenuUl);W.find("li").addClass(y.cl.uiMenuLi).hover(function(){i(this).find("ul:first").hide().show()},function(){i(this).find("ul:first").hide()})}return W}if(y.isSheetEditable()){if(J.menuLeft){L=n.createElement("td");L.className=y.cl.menu+" "+y.cl.menuFixed;M.insertBefore(L,T);y.controls.menuLeft[y.i]=i(L).append(R(J.menuLeft));y.controls.menuLeft[y.i].find("img").load(function(){y.sheetSyncSize()})}if(J.menuRight){u=n.createElement("td");u.className=y.cl.menu+" "+y.cl.menuFixed;M.appendChild(u);y.controls.menuRight[y.i]=i(u).append(R(J.menuRight));y.controls.menuRight[y.i].find("img").load(function(){y.sheetSyncSize()})}U=n.createElement("td");U.className=y.cl.label;y.controls.label=i(U);Q=n.createElement("textarea");Q.className=y.cl.formula;Q.onkeydown=y.evt.formula.keydown;Q.onkeyup=function(){y.obj.inPlaceEdit().value=this.value};Q.onchange=function(){y.obj.inPlaceEdit().value=this.value};Q.onpaste=y.evt.pasteOverCells;Q.onfocus=function(){y.setNav(false)};Q.onfocusout=function(){y.setNav(true)};Q.onblur=function(){y.setNav(true)};y.controls.formula=i(Q);var O=n.createElement("span");O.appendChild(Q);S=n.createElement("table");K=n.createElement("tr");S.appendChild(K);P.appendChild(S);s=n.createElement("td");s.className=y.cl.formulaParent;s.appendChild(O);K.appendChild(U);K.appendChild(s);y.resizableSheet(i(O),{minHeight:y.controls.formula.height(),maxHeight:78,handles:"s",resize:function(X,W){y.controls.formula.height(W.size.height)},stop:function(){y.sheetSyncSize()}});var V=i.sheet.instance;for(var N=0;N<V.length;N++){(V||{}).nav=false}y.setNav(true);i(n).keydown(y.evt.document.keydown)}return P},ui:function(){var s=n.createElement("div");s.setAttribute("class",y.cl.ui);y.obj.ui=s;return s},sheetAdder:function(){var s=n.createElement("span");if(y.isSheetEditable()){s.setAttribute("class",y.cl.sheetAdder+" "+y.cl.tab+" "+y.cl.uiTab+" ui-corner-bottom");s.setAttribute("title",y.msg.addSheet);s.innerHTML="&nbsp;+&nbsp;";s.onmousedown=function(){y.addSheet();return false};s.i=-1}return y.controls.sheetAdder=i(s)},tabContainer:function(){var s=n.createElement("span"),u;s.setAttribute("class",y.cl.tabContainer);s.onmousedown=function(K){K=K||k.event;var I=(K.target||K.srcElement).i;if(I>=0){y.trigger("sheetSwitch",[I])}return false};s.ondblclick=function(K){K=K||k.event;var I=(K.target||K.srcElement).i;if(I>=0){y.trigger("sheetRename",[I])}return false};if(y.isSheetEditable()&&i.fn.sortable){return y.controls.tabContainer=i(s).sortable({placeholder:"ui-state-highlight",axis:"x",forceHelperSize:true,forcePlaceholderSize:true,opacity:0.6,start:function(K,I){u=I.item.index();y.trigger("sheetTabSortStart",[K,I])},update:function(K,I){y.trigger("sheetTabSortUpdate",[K,I,u])}})}return y.controls.tabContainer=i(s)},sheetUI:function(Q,R,L){y.i=L;y.tuneTableForSheetUse(R);y.readOnly[L]=(R.className||"").match(/\breadonly\b/i)!=null;var M=y.controlFactory.enclosure(R),I=M.pane,u=i(I),N=function(V){V=V||k.event;if(y.isBusy()){return false}if(y.isBar(V.target)){var T=V.target.entity,U=y.getBarIndex[T](V.target);if(U<0){return false}if(y.evt.barInteraction.first==y.evt.barInteraction.last){y.controlFactory.barMenu[T](V,U)}}else{y.controlFactory.tdMenu(V)}return false};Q.appendChild(M);y.controlFactory.barTop(R);y.controlFactory.barLeft(R);I.appendChild(R);if(y.isSheetEditable()){y.controlFactory.autoFiller(I)}if(y.isSheetEditable()){var O=y.obj.formula(),S="";u.mousedown(function(T){y.setNav(true);if(y.isBusy()){return false}if(y.isCell(T.target)){if(T.button==2){N.call(this,T);y.evt.cellOnMouseDown(T);return true}y.evt.cellOnMouseDown(T);return false}if(y.isBar(T.target)){if(T.button==2){N.call(this,T)}S=T.target.entity;y.evt.barInteraction.select(T.target);return false}return true});I.onmouseup=function(){S=""};I.onmouseover=function(X){X=X||k.event;var W=X.target||X.srcElement;if(y.isBusy()){return false}if(!y.isBar(W)){return false}var V=i(W),T=W.entity,U=y.getBarIndex[T](W);if(U<0){return false}if(y.evt.barInteraction.selecting&&T==S){y.evt.barInteraction.last=U;y.cellSetActiveBar(T,y.evt.barInteraction.first,y.evt.barInteraction.last)}else{y.resizeBar[T](V,U,I,R);if(y.isSheetEditable()){y.controlFactory.barHandleFreeze[T](I);if(T=="top"){y.controlFactory.barMenu[T](X,U,V)}}}return true};I.ondblclick=y.evt.cellOnDblClick;u.bind("contextmenu",N).disableSelectionSpecial().bind("cellEdit",y.evt.cellEdit)}y.themeRoller.start(R);y.createSpreadsheet(R,L);y.checkMinSize(R);y.controlFactory.tab();var K=y.s,s=K.hiddenRows,P=K.hiddenColumns;if(!s.length||!P.length){s=R.attributes["data-hiddenrows"]||{value:""};P=R.attributes["data-hiddencolumns"]||{value:""};if(s.value.length>0){s=f.toNumbers(s.value.split(","))}if(P.value.length>0){P=f.toNumbers(P.value.split(","))}}M.actionUI.hide(s,P,y.rows(R),y.cols(R));y.setChanged(true)},enclosure:function(I){var M=n.createElement("div"),L=n.createElement("div"),u=i(L),s=new h.ActionUI(L,M,I,y.cl.scroll,y.s.frozenAt[y.i],i.sheet.max),K=s.scrollUI;I.size=function(){return y.sheetSize(I)};K.onscroll=function(){if(!y.isBusy()){var O=s.scrollTo({axis:"x",pixel:this.scrollLeft}),N=s.scrollTo({axis:"y",pixel:this.scrollTop});if(O||N){if(O){setTimeout(function(){y.calcVisibleCol(s)},0)}if(N){setTimeout(function(){y.calcVisibleRow(s)},0)}y.obj.barHelper().remove();y.autoFillerGoToTd();if(M.inPlaceEdit){M.inPlaceEdit.goToTd()}}}};K.onmousedown=function(){y.obj.barHelper().remove()};L.actionUI=M.actionUI=s;L.scrollUI=M.scrollUI=K;L.appendChild(L.scrollUI);M.setAttribute("class",y.cl.pane+" "+y.cl.uiPane);L.appendChild(M);L.setAttribute("class",y.cl.enclosure);L.pane=M;L.table=I;M.table=I;M.enclosure=L;M.$enclosure=u;I.pane=M;I.enclosure=L;I.$enclosure=u;y.controls.pane[y.i]=M;y.controls.panes=y.obj.panes().add(M);y.controls.enclosure[y.i]=u;y.controls.enclosures=y.obj.enclosures().add(L);return L},tab:function(){var s=n.createElement("span"),u=y.controls.tab[y.i]=i(s).appendTo(y.obj.tabContainer());s.setAttribute("class",y.cl.tab);y.sheetTab(true,function(I){s.innerHTML=I});s.i=y.i;s.setAttribute("class",y.cl.uiTab+" ui-corner-bottom");y.controls.tabs=y.obj.tabs().add(u);return s},inPlaceEdit:function(N,u){N=N||y.obj.tdActive();if(!N.length){N=i(y.rowTds(null,1)[1]);y.cellEdit(N)}if(!N.length){return}(y.obj.inPlaceEdit().destroy||E)();var M=y.obj.formula(),I=M.val(),s,L,K=y.obj.pane();if(!N[0].isHighlighted){return}s=n.createElement("textarea");L=i(s);K.inPlaceEdit=s;s.i=y.i;s.className=y.cl.inPlaceEdit+" "+y.cl.uiInPlaceEdit;s.td=N[0];s.goToTd=function(){this.offset=N.position();if(!this.offset.left&&!this.offset.right){i(s).hide()}else{this.setAttribute("style","left:"+(this.offset.left-1)+"px;top:"+(this.offset.top-1)+"px;width:"+this.td.clientWidth+"px;height:"+this.td.clientHeight+"px;min-width:"+this.td.clientWidth+"px;min-height:"+this.td.clientHeight+"px;")}};s.goToTd();s.onkeydown=y.evt.inPlaceEdit.keydown;s.onchange=s.onkeyup=function(){M[0].value=s.value};s.onfocus=function(){y.setNav(false)};s.onblur=s.onfocusout=function(){y.setNav(true)};s.onpaste=y.evt.pasteOverCells;s.destroy=function(){K.inPlaceEdit=null;y.cellLast.isEdit=(s.value!=I);s.parentNode.removeChild(s);y.controls.inPlaceEdit[s.i]=false};K.appendChild(s);s.onfocus();y.controls.inPlaceEdit[y.i]=s;L.focus().val("").val(M[0].value);if(u){L.select()}if(i.fn.elastic){i(s).elastic()}},autoFiller:function(K){if(!J.autoFiller){return false}var u=n.createElement("div"),s=n.createElement("div"),I=n.createElement("div");u.i=y.i;u.className=y.cl.autoFiller+" "+y.cl.uiAutoFiller;s.className=y.cl.autoFillerHandle;I.className=y.cl.autoFillerCover;u.onmousedown=function(){var M=y.obj.tdActive();if(M){var L=y.getTdLocation(M);y.cellSetActive(M,L,true,y.autoFillerNotGroup,function(){var O=y.highlighted(),N=y.getTdLocation(O.last());y.fillUpOrDown(N.row<L.row||N.col<L.col);y.autoFillerGoToTd(M);y.autoFillerNotGroup=false})}return false};K.autoFiller=y.controls.autoFiller[y.i]=i(u);K.appendChild(u);return true}},autoFillerNotGroup:true,updateCellsAfterPasteToFormula:function(Q){var P=0,O=y.obj.formula(),S=new m();Q=Q||O.val();var N={row:y.cellLast.row,col:y.cellLast.col},u=O.val(),K=u;if(N.row==0&&N.col==0){return false}var T=tsv.parse(u);if(!i.isArray(T)){O.val(T);y.fillUpOrDown(false,T);return true}for(var M=0;M<T.length;M++){y.cellLast.isEdit=true;var s=T[M];for(var L=0;L<s.length;L++){P++;var I=y.getTd(y.i,M+N.row,L+N.col);I.row=N.row;I.col=N.col;if(I.length){if(!y.spreadsheets[y.i]||!y.spreadsheets[y.i][M+N.row]||!y.spreadsheets[y.i][M+N.row][L+N.col]){continue}var R=y.spreadsheets[y.i][M+N.row][L+N.col];if(R){J.parent.one("sheetPreCalculation",function(){if((s[L]+"").charAt(0)=="="){R.formula=s[L].substring(1);R.value="";I.data("formula",s[L])}else{R.formula="";R.value=s[L];I.removeData("formula")}});y.calcDependencies.call(R);if(M==0&&L==0){K=s[L]}}}}}if(u!=K){O.val(K)}y.fillUpOrDown(false,K);y.evt.cellEditDone(true);return true},evt:{inPlaceEdit:{enter:function(s){if(s.shiftKey){return true}return y.evt.cellSetActiveFromKeyCode(s,true)},tab:function(s){if(s.shiftKey){return true}return y.evt.cellSetActiveFromKeyCode(s,true)},keydown:function(s){s=s||k.event;y.trigger("sheetFormulaKeydown",[true]);switch(s.keyCode){case p.ENTER:return y.evt.inPlaceEdit.enter(s);break;case p.TAB:return y.evt.inPlaceEdit.tab(s);break;case p.ESCAPE:y.evt.cellEditAbandon();return false;break}}},formula:{keydown:function(s){s=s||k.event;if(y.readOnly[y.i]){return false}if(y.cellLast.row<0||y.cellLast.col<0){return false}y.trigger("sheetFormulaKeydown",[false]);switch(s.keyCode){case p.C:if(s.ctrlKey){return y.evt.document.copy(s)}case p.X:if(s.ctrlKey){return y.evt.document.cut(s)}case p.Y:if(s.ctrlKey){y.evt.document.redo(s);return false}break;case p.Z:if(s.ctrlKey){y.evt.document.undo(s);return false}break;case p.ESCAPE:y.evt.cellEditAbandon();return true;break;case p.ENTER:y.evt.cellSetActiveFromKeyCode(s,true);return false;break}y.cellLast.isEdit=true},If:function(u,s){if(u){y.obj.tdActive().dblclick();return true}return false}},document:{enter:function(s){if(!y.cellLast.isEdit&&!s.ctrlKey){y.obj.tdActive().dblclick()}return false},tab:function(s){y.evt.cellSetActiveFromKeyCode(s)},findCell:function(s){if(s.ctrlKey){y.cellFind();return false}return true},redo:function(s){if(s.ctrlKey&&!y.cellLast.isEdit){y.undo.manager.redo();return false}return true},undo:function(s){if(s.ctrlKey&&!y.cellLast.isEdit){y.undo.manager.undo();return false}return true},copy:function(L,u){var K=y.highlighted(true),M=y.obj.formula(),I=M.val(),s=y.toTsv(K,u);M.val(s).focus().select();w.one("keyup",function(){if(u){M.val("")}else{M.val(I)}});return true},cut:function(s){return this.copy(s,true)},pageUpDown:function(s){var K=y.sheetSize(),O=y.obj.pane(),I=O.clientHeight,L=0,M=0,N,u;if(s){for(u=y.cellLast.row;u>0&&L<I;u--){N=y.getTd(y.i,u,1);if(!N.data("hidden")&&N.is(":hidden")){N.show()}L+=N.parent().height()}}else{for(u=y.cellLast.row;u<K.rows&&L<I;u++){N=y.getTd(y.i,u,1);L+=N.parent().height()}}y.cellEdit(N);return false},keydown:function(s){s=s||k.event;if(y.readOnly[y.i]){return false}if(y.cellLast.row<0||y.cellLast.col<0){return false}var u=y.cellLast.td;if(y.nav){switch(s.keyCode){case p.DELETE:y.toTsv(null,true);y.obj.formula().val("");break;case p.TAB:y.evt.document.tab(s);break;case p.ENTER:y.evt.cellSetActiveFromKeyCode(s);break;case p.LEFT:case p.UP:case p.RIGHT:case p.DOWN:(s.shiftKey?y.evt.cellSetHighlightFromKeyCode(s):y.evt.cellSetActiveFromKeyCode(s));break;case p.PAGE_UP:y.evt.document.pageUpDown(true);break;case p.PAGE_DOWN:y.evt.document.pageUpDown();break;case p.HOME:case p.END:y.evt.cellSetActiveFromKeyCode(s);break;case p.V:if(s.ctrlKey){return y.evt.formula.If(!y.evt.pasteOverCells(s),s)}else{u.trigger("cellEdit");return true}break;case p.Y:if(s.ctrlKey){y.evt.document.redo(s);return false}else{u.trigger("cellEdit");return true}break;case p.Z:if(s.ctrlKey){y.evt.document.undo(s);return false}else{u.trigger("cellEdit");return true}break;case p.ESCAPE:y.evt.cellEditAbandon();break;case p.F:if(s.ctrlKey){return y.evt.formula.If(y.evt.document.findCell(s),s)}else{u.trigger("cellEdit");return true}break;case p.CAPS_LOCK:case p.SHIFT:case p.ALT:break;case p.CONTROL:y.obj.formula().focus().select();return true;break;default:u.trigger("cellEdit");return true;break}return false}}},pasteOverCells:function(u){u=u||k.event;if(u.ctrlKey||u.type=="paste"){var s=function(){y.updateCellsAfterPasteToFormula()};var I=w.one("keyup",function(){s();s=function(){};I.mouseup()}).one("mouseup",function(){s();s=function(){};I.keyup()});y.setDirty(true);y.setChanged(true);return true}return false},cellEditDone:function(I){(y.obj.inPlaceEdit().destroy||E)();if(y.cellLast.isEdit||I){var L=y.obj.formula(),K=y.obj.tdActive();if(y.isFormulaEditable(K)){if(K&&y.cellLast.row>0&&y.cellLast.col>0){var u=L.val(),s=K[0].jSCell;if(!s.edited){s.edited=true;y.controls.cellsEdited[y.i]=y.obj.cellsEdited().add(s)}J.parent.one("sheetPreCalculation",function(){if(u.charAt(0)=="="&&y.formulaParser){K.data("formula",u);s.value=u;s.formula=u}else{K.removeData("formula");s.value=u;s.formula=""}});y.calcDependencies.call(s);y.cellLast.isEdit=false;y.trigger("sheetCellEdited",[s])}}}},cellEditAbandon:function(s){(y.obj.inPlaceEdit().destroy||E)();y.themeRoller.bar.clearActive();y.themeRoller.cell.clearHighlighted(null,true);if(!s){y.calc()}y.cellLast.td=i([]);y.cellLast.row=0;y.cellLast.col=0;y.rowLast=0;y.colLast=0;y.highlightedLast.start={row:0,col:0};y.highlightedLast.end={row:0,col:0};y.labelUpdate("",true);y.obj.formula().val("").blur();y.autoFillerHide();return false},cellSetHighlightFromKeyCode:function(K){var I=y.highlightedLastOrdered(),u=y.sheetSize(),N=y.obj.tdActive(),L=y.getTdLocation(N),M=I.start,s=I.end;switch(K.keyCode){case p.UP:if(M.row<L.row){M.row--;M.row=C.max(M.row,1);break}s.row--;s.row=C.max(s.row,1);break;case p.DOWN:if(M.row===M.end){M.row++;M.row=C.min(M.row,u.rows);break}if(M.row<L.row){M.row++;M.row=C.max(M.row,1);break}s.row++;s.row=C.min(s.row,u.rows);break;case p.LEFT:if(M.col<L.col){M.col--;M.col=C.max(M.col,1);break}s.col--;s.col=C.max(s.col,1);break;case p.RIGHT:if(M.col<L.col){M.col++;M.col=C.min(M.col,u.cols);break}s.col++;s.col=C.min(s.col,u.cols);break}y.highlightedLast.start=M;y.highlightedLast.end=s;y.cycleCellArea(function(O){y.themeRoller.cell.setHighlighted(O.td)},M,s);return false},cellSetActiveFromKeyCode:function(L,s){var M={row:y.cellLast.row,col:y.cellLast.col},K=false,I,u=false;switch(L.keyCode){case p.UP:M.row--;break;case p.DOWN:M.row++;break;case p.LEFT:M.col--;break;case p.RIGHT:M.col++;break;case p.ENTER:M=y.evt.incrementAndStayInGrid(y.highlightedLastOrdered(),M,"row","col",L.shiftKey);K=true;I=y.highlighted();if(I.length>1){u=true}else{if(!s){M.row+=(L.shiftKey?-1:1)}if(J.autoAddCells&&M.row>y.sheetSize().rows){y.controlFactory.addRow()}}break;case p.TAB:M=y.evt.incrementAndStayInGrid(y.highlightedLastOrdered(),M,"col","row",L.shiftKey);K=true;I=y.highlighted();if(I.length>1){u=true}else{if(!s){M.col+=(L.shiftKey?-1:1)}if(J.autoAddCells&&M.col>y.sheetSize().cols){y.controlFactory.addColumn()}}break;case p.HOME:M.col=1;break;case p.END:M.col=y.obj.tdActive().parent().children("td").length-1;break}M.col=M.col||1;M.row=M.row||1;if(!y.cellLast.isEdit||K){var N=y.getTd(y.i,M.row,M.col);if(N){y.cellEdit(N,null,u);return false}}return true},incrementAndStayInGrid:function(K,L,u,s,I){if(I){L[u]--;if(L[u]<K.start[u]){L[u]=K.end[u];L[s]--}if(L[s]<K.start[s]){L[s]=K.end[s]}}else{L[u]++;if(L[u]>K.end[u]){L[u]=K.start[u];L[s]++}if(L[s]>K.end[s]){L[s]=K.start[s]}}return L},cellOnMouseDown:function(s){y.obj.formula().blur();if(s.shiftKey){y.getTdRange(s,y.obj.formula().val())}else{y.cellEdit(i(s.target),true)}},cellOnDblClick:function(s){if(y.isBusy()){return false}y.controlFactory.inPlaceEdit();return true},cellEdit:function(s){if(y.isBusy()){return false}y.controlFactory.inPlaceEdit(null,true);return true},barInteraction:{first:0,last:0,selecting:false,select:function(I){if(!I){return}if(!I.type=="bar"){return}var s=I.entity,u=y.getBarIndex[s](I);if(u<0){return false}y[s+"Last"]=u;y.evt.barInteraction.last=y.evt.barInteraction.first=u;y.cellSetActiveBar(s,y.evt.barInteraction.first,y.evt.barInteraction.last);y.evt.barInteraction.first=y.evt.barInteraction.last=y[s+"Last"]=u;y.evt.barInteraction.selecting=true;w.one("mouseup",function(){y.evt.barInteraction.selecting=false});return false}}},refreshColumnLabels:function(I){I=I||0;y.obj.barMenuParentTop().trigger("destroy");var u=y.controls.bar.x.td[y.i];if(!u){return}for(var s=I;s<u.length;s++){if(s){u[s].text(d.columnLabelString(u[s][0].cellIndex))}}},refreshRowLabels:function(K,s){K=K||0;var I=y.controls.bar.y.td[y.i];if(!I){return}s=s||I.length;for(var u=K;u<s;u++){if(u){i(I[u]).text(I[u][0].parentNode.rowIndex)}}},isCell:function(s){if(s&&s.tagName&&s.tagName=="TD"&&s.type&&s.type=="cell"){return true}return false},isBar:function(s){if(s&&s.tagName&&s.tagName=="TD"&&s.type&&s.type=="bar"){return true}return false},readOnly:[],isSheetEditable:function(s){s=s||y.i;return(J.editable==true&&!y.readOnly[s])},isFormulaEditable:function(s){if(J.lockFormulas){if(s.data("formula")!==G){return false}}return true},toggleFullScreen:function(){if(!y){return}y.evt.cellEditDone();var I=y.obj.fullScreen(),M=y.obj.pane();if(I.is(":visible")){r.unbind("jSResize");x.removeClass("bodyNoScroll");J.parent=I[0].origParent;J.parent.prepend(I.children());I.remove();y.sheetSyncSize();M.resizeScroll();y.trigger("sheetFullScreen",[false])}else{x.addClass("bodyNoScroll");var K=i(J.parent),I=n.createElement("div"),u=i._data(J.parent[0],"events");I.className=y.cl.fullScreen+" "+y.cl.uiFullScreen+" "+y.cl.parent;I.origParent=K;J.parent=y.controls.fullScreen=i(I).append(K.children()).appendTo(x);r.bind("resize",function(){r.trigger("jSResize")}).bind("jSResize",function(){this.w=r.width();this.h=r.height();J.parent.width(this.w).height(this.h);y.sheetSyncSize();M.resizeScroll()}).trigger("jSResize");K.trigger("sheetFullScreen",[true]);for(var L in u){for(var s=0;s<u[L].length;s++){J.parent.bind(L,u[L][s].handler)}}}},renameSheet:function(s){if(v(s)){return false}if(s>-1){y.sheetTab()}return true},switchSheet:function(s){if(v(s)){return false}if(s==-1){y.addSheet()}else{if(s!=y.i){y.setActiveSheet(s);y.calc(s)}}return true},tuneTableForSheetUse:function(I){var u=i(I);y.controls.table[y.i]=u.addClass(y.cl.table).addClass(y.cl.uiTable).attr("id",y.id+y.i).attr("border","1px").attr("cellpadding","0").attr("cellspacing","0");y.formatTable(I);y.sheetDecorateRemove(false,u);y.controls.tables=y.obj.tables().add(I);var K=u.attr("data-frozenatrow")*1,s=u.attr("data-frozenatcol")*1;if(!y.s.frozenAt[y.i]){y.s.frozenAt[y.i]={row:0,col:0}}if(K){y.s.frozenAt[y.i].row=K}if(s){y.s.frozenAt[y.i].col=s}},createSpreadsheet:function(I,u){I.spreadsheet=y.spreadsheets[u]=[];var K=y.rows(I),L=K.length-1,s;if(L<0){return}do{s=K[L].children.length-1;if(s<0){return}do{var M=K[L].children[s];if(L>0&&s>0){y.createCell(u,L,s)}else{if(s==0&&L>0){M.type="bar";M.entity="left";M.innerHTML=L;M.className=y.cl.barLeft+" "+y.cl.barLeft+"_"+y.i+" "+y.cl.uiBar;M.setAttribute("style","height:"+M.nextSibling.style.height)}if(L==0&&s>0){M.type="bar";M.entity="top";M.innerHTML=d.columnLabelString(s);M.className=y.cl.barTop+" "+y.cl.barTop+"_"+y.i+" "+y.cl.uiBar}if(L==0&&s==0){M.type="bar";M.entity="corner";M.className=y.cl.uiBar+"  "+y.cl.barCorner;y.controls.bar.corner[y.i]=M}}}while(s--)}while(L--)},toggleHideRow:function(s){s=s||y.rowLast;if(!s){return}var I=y.rows()[s],u=y.obj.pane().actionUI;u.toggleHideRow(I,s);y.autoFillerGoToTd()},toggleHideColumn:function(u){u=u||y.colLast;if(!u){return}var s=y.cols()[u],I=y.obj.pane().actionUI;I.toggleHideColumn(s,u);y.autoFillerGoToTd()},rowShowAll:function(){y.obj.pane().actionUI.rowShowAll()},columnShowAll:function(){y.obj.pane().actionUI.columnShowAll()},merge:function(O){O=O||y.highlighted();if(!O.length){return}var M=[],u=O[0],L=O[O.length-1],T=y.getTdLocation(u),I=y.getTdLocation(L),W={},R={},Q=0,S=0,V=new m(),N=O.length-1,U,X,K,s,P;if(T.row){y.setDirty(true);y.setChanged(true);if(T.row<I.row){W.row=T.row;R.row=I.row;K=u}else{W.row=I.row;R.row=T.row;K=L}if(K.getAttribute("rowSpan")||K.getAttribute("colSpan")){return false}s=i(K);if(T.col<I.col){W.col=T.col;R.col=I.col}else{W.col=I.col;R.col=T.col}S=(R.row-W.row)+1;Q=(R.col-W.col)+1;P=y.getTdLocation(K);do{X=O[N];U=X.jSCell;if(U.formula||U.value){M.unshift(U.formula?"("+U.formula.substring(1)+")":U.value)}J.parent.one("sheetPreCalculation",function(){if(X.cellIndex!=P.col||X.parentNode.rowIndex!=P.row){U.formula=null;U.value="";U.html="";U.defer=K.jSCell;U.calcLast=V;X.removeAttribute("data-formula");X.removeAttribute("data-celltype");X.innerHTML="";X.style.display="none";X.colSpan=Q-(X.cellIndex-K.cellIndex);X.rowSpan=S-(X.parentNode.rowIndex-K.parentNode.rowIndex)}});y.calcDependencies.call(U)}while(N--);K.jSCell.value=M.join(" ");K.jSCell.formula=(K.jSCell.formula?M.join(" "):"");K.jSCell.calcLast=V;K.style.display="";K.setAttribute("rowSpan",S);K.setAttribute("colSpan",Q);y.calcDependencies.call(K.jSCell);y.evt.cellEditDone();y.autoFillerGoToTd(s);y.cellSetActive(s,P)}return true},unmerge:function(s){s=s||y.highlighted();if(!s){return}var I=s[0],N=y.getTdLocation(I),O=new m(),Q=C.max(I.getAttribute("rowSpan")*1,1)-1,u=C.max(I.getAttribute("colSpan")*1,1)-1,M=Q+N.row,K,P,L=[];if(Q==0&&u==0){return false}do{K=N.col+u;do{P=y.getTd(y.i,M,K)[0];P.style.display="";P.removeAttribute("colSpan");P.removeAttribute("rowSpan");P.jSCell.defer=null;y.calcDependencies.call(P.jSCell,O);L.push(P)}while(K-->N.col)}while(M-->N.row);y.evt.cellEditDone();y.autoFillerGoToTd(s);y.cellSetActive(s,N);y.themeRoller.cell.setHighlighted(i(L));return true},fillUpOrDown:function(O,Q,S){y.evt.cellEditDone();S=S||y.highlighted(true);if(S.length<1){return false}var L=y.obj.tdActive(),P=new m();if(S.length<1){return false}var M=y.getTdLocation(S[0].td),T=y.getTdLocation(S[S.length-1].td),s=y.getTdLocation(L),I={row:0,col:0},u=Q||L[0].jSCell.value,R=false,K=S.length-1,N=function(){};Q=Q||L[0].jSCell.value;if(K>=0){if(Q.charAt&&Q.charAt(0)=="="){if(K>=0){do{if(!O){I.row=s.row-T.row;I.col=s.col-T.col}else{I.row=s.row-M.row;I.col=s.col-M.col}u=y.reparseFormula(Q,I);J.parent.one("sheetPreCalculation",function(){S[K].formula=u;S[K].value="";S[K].td.data("formula",u)});y.calcDependencies.call(S[K],P)}while(K--);return true}}else{if((R=!v(u))||u.length>0){if(R&&u!=""){u*=1;if(O){u-=S.length-1}N=function(){u++}}}do{J.parent.one("sheetPreCalculation",function(){S[K].formula="";S[K].value=u+"";S[K].td.removeData("formula")});y.calcDependencies.call(S[K],P);N()}while(K--);return true}}return false},toTsv:function(S,K,Q){S=S||y.highlighted(true);if(S.type){S=[S]}Q=Q||function(V,U){if(K){J.parent.one("sheetPreCalculation",function(){U.formula="";U.value=""});y.calcDependencies.call(U,P)}};var N=[],R,M,u={},P=new m(),I=S.length-1,T,s;if(I>=0){R=y.getTdLocation(S[0].td);M=y.getTdLocation(S[S.length-1].td);u.row=C.min(R.row,M.row);u.col=C.min(R.col,M.col);do{var L=y.getTdLocation(S[I].td),O=(S[I].formula?"="+S[I].formula:S[I].value);T=C.abs(L.row-u.row);s=C.abs(L.col-u.col);if(!N[T]){N[T]=[]}if((O+="").match(/\n/)){O='"'+O+'"'}N[T][s]=(O||"");Q.call(S[I].td,L,S[I])}while(I-->0);I=N.length-1;do{N[I]=N[I].join("\t")}while(I-->0);return N.join("\n")}return""},offsetFormulas:function(O,N,I,M){var u=y.sheetSize(),L={first:{row:1,col:1},last:{row:u.rows,col:u.cols}},K=new m(),s=[];y.cycleCells(function(){var P=this;if(this.formula&&typeof this.formula=="string"&&y.isFormulaEditable(this.td)){this.formula=y.reparseFormula(this.formula,N,O,I,M);this.td.data("formula","="+this.formula)}s.push(function(){y.calcDependencies.call(P,K,true)})},L.first,L.last);while(s.length){s.pop()()}y.evt.cellEditDone()},reparseFormula:function(L,K,I,s,u){return L.replace(d.regEx.cell,function(N,O,S,T){if(O=="SHEET"){return N}K=K||{loc:0,row:0};var M={row:S*1,col:d.columnLabelIndex(O)},R,Q,P={row:S,col:O,use:false};if(I){if(u){if(s){if(M.col&&M.col==I.col-1){P.col="#REF!";P.use=true}if(M.row&&M.row==I.row-1){P.row="#REF!";P.use=true}if(M.col>=I.col){R=true}if(M.row>=I.row){Q=true}}else{if(I.col&&M.col==I.col){P.col="#REF!";P.use=true}if(I.row&&M.row==I.row){P.row="#REF!";P.use=true}if(I.col&&M.col>I.col){R=true}if(I.row&&M.row>I.row){Q=true}}if(P.use){return P.col+P.row}if(R){M.col+=K.col;return y.makeFormula(M)}if(Q){M.row+=K.row;return y.makeFormula(M)}}else{if(s){if(I.col&&M.col>=I.col){R=true}if(I.row&&M.row>=I.row){Q=true}}else{if(I.col&&M.col>I.col){R=true}if(I.row&&M.row>I.row){Q=true}}if(R){M.col+=K.col;return y.makeFormula(M)}if(Q){M.row+=K.row;return y.makeFormula(M)}}}else{return y.makeFormula(M,K)}return N})},makeFormula:function(u,s){s=i.extend({row:0,col:0},s);u.col+=s.col;u.row+=s.row;if(u.col<0){u.col=0}if(u.row<0){u.row=0}return d.parseCellName(u.col,u.row)},cycleCells:function(K,N,L,I){I=I||y.i;N=N||{row:1,col:1};if(!L){var u=y.sheetSize();L={row:u.rows,col:u.cols}}var M=L.row,s;if(M<N.row){return}do{s=L.col;do{K.call(y.spreadsheets[I][M][s],I,M,s)}while(s-->N.col)}while(M-->N.row)},cycleCellsAll:function(K){var L=y.i,I,u,s;for(I=0;I<=y.sheetCount;I++){y.i=I;u=y.sheetSize();s={row:u.rows,col:u.cols};y.cycleCells(K,{row:0,col:0},s,I)}y.i=L},cycleCellArea:function(P,T,M,L,Q){var s={start:{},end:{}},O,S,U,R,K=y.i,u={cell:[],td:[]},N=y.spreadsheets[K],I=(Q?"unshift":"push");if(L){s.start=T;s.end=M}else{s.start.row=C.max(C.min(T.row,M.row),1);s.start.col=C.max(C.min(T.col,M.col),1);s.end.row=C.max(T.row,M.row,1);s.end.col=C.max(T.col,M.col,1)}O=s.end.row;do{S=s.end.col;U=N[O]||null;do{if(U){R=U[S]||null;if(R){u.cell[I](R);u.td[I](R.td[0])}}}while(S-->s.start.col)}while(O-->s.start.row);if(P){P(u)}},formatTable:function(T){var R=J.newColumnWidth,O=J.colMargin,I=T.children,M=I.length-1,L,K,Q,u,P,S,N;if(M>-1){do{switch(I[M].nodeName){case"TBODY":S=true;Q=I[M];break;case"COLGROUP":N=true;u=I[M];break}}while(M--)}else{var s=n.createElement("tr");s.appendChild(n.createElement("td"));T.appendChild(s);I=T.children}if(!Q){Q=n.createElement("tbody");do{Q.appendChild(I[0])}while(I.length)}if(!u||u.children.length<1){u=n.createElement("colgroup");T.appendChild(u);T.appendChild(Q);P=Q.children[0];for(M=0,L=P.children.length;M<L;M++){K=n.createElement("col");u.appendChild(K);K.style.width=R+"px"}for(M=0,L=Q.children.length;M<L;M++){Q.children[M].style.height=O+"px"}}T.tBody=Q;T.colGroup=u;T.removeAttribute("width");T.style.width=""},checkMinSize:function(L){var I=y.sheetSize(L),M=J.minSize.rows||0,s=J.minSize.cols||0,K=y.obj.pane().actionUI,u=K.frozenAt;M=(u.row>M?u.row+1:M);s=(u.col>s?u.col+1:s);if(I.cols<s){y.controlFactory.addColumnMulti(null,s-I.cols)}if(I.rows<M){y.controlFactory.addRowMulti(null,M-I.rows)}},themeRoller:{start:function(s){y.obj.header().addClass(y.cl.uiControl);y.obj.label().addClass(y.cl.uiControl);y.obj.formula().addClass(y.cl.uiControlTextBox)},cell:{setHighlighted:function(K){K=K||i([]);var s,I=y.highlightedLast.obj,u=y.obj.pane().actionUI;if(I&&I.length>0){s=I.length-1;do{I[s].isHighlighted=false}while(s-->0)}if(K.length>0){s=K.length-1;do{if(!K[s].isHighlighted){K[s].isHighlighted=true;if(!K[s].className.match(y.cl.uiTdHighlighted)){K[s].className+=" "+y.cl.uiTdHighlighted}}}while(s-->0)}y.themeRoller.cell.clearHighlighted.call(K,I);u.redraw()},isHighlighted:function(){return(y.highlightedLast.obj.length?true:false)},clearHighlighted:function(I,u){if(y.themeRoller.cell.isHighlighted()){I=I||y.highlightedLast.obj;if(I&&I.length){var s=I.length-1;do{if(!I[s].isHighlighted||u){I[s].className=I[s].className.replace(y.cl.uiTdHighlighted,"");I[s].isHighlighted=false}}while(s-->0)}}if(this.length){y.highlightedLast.obj=this}else{y.highlightedLast.obj=i([])}}},bar:{style:function(s){i(s).addClass(y.cl.uiBar)},setActive:function(s,u){switch(s){case"top":y.highlightedLast.barTop.removeClass(y.cl.uiBarHighlight);y.highlightedLast.barTop=i(u).addClass(y.cl.uiBarHighlight);break;case"left":y.highlightedLast.barLeft.removeClass(y.cl.uiBarHighlight);y.highlightedLast.barLeft=i(u).addClass(y.cl.uiBarHighlight);break}},clearActive:function(){y.highlightedLast.barLeft.removeClass(y.cl.uiBarHighlight);y.highlightedLast.barLeft=i([]);y.highlightedLast.barTop.removeClass(y.cl.uiBarHighlight);y.highlightedLast.barTop=i([])}},tab:{setActive:function(){this.clearActive();y.obj.tab().addClass(y.cl.uiTabActive)},clearActive:function(){y.obj.tabContainer().find("span."+y.cl.uiTabActive).removeClass(y.cl.uiTabActive)}}},resizable:function(u,s){if(!u.data("resizable")){u.resizable(s)}},busy:[],setBusy:function(s){if(s){y.busy.push(s)}else{y.busy.pop()}},isBusy:function(){return(y.busy.length>0)},draggable:function(u,s){if(!u.data("jSdraggable")){u.data("jSdraggable",true).draggable(s)}},nearest:function(u,s){return i(u).nearest(s)},resizeBar:{top:function(M,I,O,u){y.obj.barTopControls().remove();var K=n.createElement("div"),N=i(K).addClass(y.cl.barController+" ui-state-highlight").width(M.width()).height(0).prependTo(M),s,L;y.controls.bar.x.controls[y.i]=y.obj.barTopControls().add(N);y.resizableCells(N,{handles:"e",start:function(Q,P){y.autoFillerHide();y.setBusy(true);s=y.col(u,I);if(O.freezeHandleTop){O.freezeHandleTop.remove()}s.removeAttribute("width")},resize:function(Q,P){s.style.width=P.size.width+"px";if(O.inPlaceEdit){O.inPlaceEdit.goToTd()}},stop:function(Q,P){y.setBusy(false);O.resizeScroll();y.followMe();y.setDirty(true)},minWidth:32});L=K.children[0];L.style.height=M.outerHeight()+"px";L.style.position="absolute"},left:function(K,N,I,R){y.obj.barLeftControls().remove();var M=K.offset(),S=n.createElement("div"),P=i(S).addClass(y.cl.barController+" ui-state-highlight").prependTo(K).offset({top:M.top,left:M.left}),Q=K[0],L=K.next()[0],T=L.parentNode,u=n.createElement("div"),s=i(u).addClass("jSBarControllerChild").height(K.height()).prependTo(P),O;y.controls.bar.y.controls[y.i]=y.obj.barLeftControls().add(P);y.resizableCells(s,{handles:"s",start:function(){y.autoFillerHide();y.setBusy(true);if(I.freezeHandleLeft){I.freezeHandleLeft.remove()}T.removeAttribute("height");Q.removeAttribute("height");L.removeAttribute("height")},resize:function(V,U){S.style.height=L.style.height=Q.style.height=T.style.height=U.size.height+"px";if(I.inPlaceEdit){I.inPlaceEdit.goToTd()}},stop:function(V,U){y.setBusy(false);I.resizeScroll();y.followMe();y.setDirty(true)},minHeight:15});O=u.children[0];O.style.width=K.outerWidth()+"px";O.style.position="absolute"},corner:function(){}},sheetDecorateRemove:function(u,s){s=s||y.obj.tables();s=(u?s.clone():s);s.find("td."+y.cl.uiTdActive).removeClass(y.cl.uiTdActive);s.find("td."+y.cl.uiTdHighlighted).removeClass(y.cl.uiTdHighlighted);return s},labelUpdate:function(u,s){if(!s){u=d.parseCellName(u.col,u.row);if(u){y.obj.label().text(u)}}else{y.obj.label().text(u)}},cellEdit:function(N,K,I){if(y.cellLast.td.length<1){}y.autoFillerNotGroup=true;y.evt.cellEditDone();if(!N.length){return}var L=y.getTdLocation(N),s=N[0].jSCell,u;if(!s){return}if(s.uneditable){return}y.trigger("sheetCellEdit",[s]);if(!N.is(y.cellLast.td)){y.followMe(N)}else{y.autoFillerGoToTd(N)}y.labelUpdate(L);if(s.formula){u="="+s.formula}else{u=s.value}var M=y.obj.formula().val(u).blur();y.cellSetActive(N,L,K,false,null,I)},cellSetActive:function(L,N,u,P,M,I){N=N||y.getTdLocation(L);if(N.col!=G){y.cellLast.td=L;y.cellLast.row=y.rowLast=N.row;y.cellLast.col=y.colLast=N.col;if(!I){y.themeRoller.cell.setHighlighted(L);y.highlightedLast.start=N;y.highlightedLast.end=N}if(!L.length){return}y.themeRoller.bar.setActive("left",L[0].barLeft);y.themeRoller.bar.setActive("top",L[0].barTop);var O,Q;switch(J.cellSelectModel){case"excel":case"gdrive":O=function(){};Q=function(){};break;case"oo":O=function(R){if(y.isCell(R)){y.cellEdit(i(R))}};Q=function(){};break}if(u){var s={},K=y.obj.pane();s.last=N;K.onmousemove=function(Z){Z=Z||k.event;var aa=Z.target||Z.srcElement;if(y.isBusy()){return false}var R=y.highlightedLast.end=y.getTdLocation(aa),ab=true;if(R.col<1||R.row<1||R.col==F||R.row==F){return false}if(P){ab=false;if(N.col==R.col||N.row==R.row){ab=true}}if((s.last.col!=R.col||s.last.row!=R.row)&&ab){O(aa);y.cycleCellArea(function(ad){y.themeRoller.cell.setHighlighted(ad.td)},N,R,false,true)}y.followMe(i(aa));var U=Z.clientY,V=Z.clientX,W=K.$enclosure.offset(),ac=y.getTdLocation(aa),X=ac.row,T=ac.col,S=false,Y;if(v(X)||v(T)){return false}if(U>W.top){S=true;X--}if(V>W.left){S=true;T--}if(S){if(X<1||T<1){return false}Y=y.spreadsheets[y.i][X][T];y.followMe(i(Y.td),true)}s.last=R;return true};n.onmouseup=function(){K.onmousemove=null;K.onmousemove=null;K.onmouseup=null;n.onmouseup=null;if(M){M()}}}}},colLast:0,rowLast:0,cellLast:{td:i([]),row:0,col:0,isEdit:false},highlightedLast:{obj:i([]),start:{row:0,col:0},end:{row:0,col:0},barLeft:i([]),barTop:i([])},highlightedLastOrdered:function(){var u=this.highlightedLast,s={start:{},end:{}};s.start.row=c.min(u.start.row,u.end.row);s.start.col=c.min(u.start.col,u.end.col);s.end.row=c.max(u.start.row,u.end.row);s.end.col=c.max(u.start.col,u.end.col);return s},cellStyleToggle:function(N,O,L){L=L||y.highlighted();if(L.length<1){return false}y.setDirty(true);var I,s,M=L.length-1,P=y.obj.cellsEdited(),u=y.controls.cellsEdited[y.i],K;if(M>=0){K=L[0].className.match(N);do{I=L[M];s=i(I);if(O){s.removeClass(O)}if(K){s.removeClass(N)}else{s.addClass(N)}if(!I.jSCell.edited){I.jSCell.edited=true;u=P.add(I.jSCell)}}while(M--);return true}return false},cellTypeToggle:function(K,u){u=u||y.highlighted(true);if(u.length<1){return}var I=u.length-1,s=u[I].cellType==K;if(I>=0){do{if(s){u[I].cellType=null}else{u[I].cellType=K}u[I].calcLast=0;y.updateCellValue.call(u[I])}while(I--)}},fontReSize:function(N,L){L=L||y.highlighted();if(L.length<1){return false}var I=0;switch(N){case"up":I=1;break;case"down":I=-1;break}var K,s,M=L.length-1,P,O=y.obj.cellsEdited(),u=y.controls.cellsEdited[y.i];if(M>=0){do{K=L[M];s=i(K);P=(s.css("font-size")+"").replace("px","")*1;s.css("font-size",((P||10)+I)+"px");if(!K.jSCell.edited){K.jSCell.edited=true;u=O.add(K.jSCell)}}while(M--);return true}return false},callStack:0,updateCellValue:function(O,K,M){var I,P,N,L;O=O||0;K=K||-1;M=M||-1;if(K>-1){if(!(I=y.spreadsheets[O])){return J.error({error:y.msg.notFoundSheet})}if(!(P=I[K])){return J.error({error:y.msg.notFoundRow})}if(!(N=P[M])){return J.error({error:y.msg.notFoundColumn})}}else{N=this}if(N===undefined){throw new j("cell doesn't exist")}N.oldValue=N.value;if(N.result){delete N.result}switch(N.state[N.state.length-1]){case"updating":return J.error({error:y.msg.loopDetected});case"updatingDependencies":return(N.valueOverride!=G?N.valueOverride:N.value)}if(N.defer){return y.updateCellValue.call(N.defer)}N.state.push("updating");N.fnCount=0;N.result=null;if(N.calcLast!=y.calcLast||N.calcDependenciesLast!=y.calcDependenciesLast){N.valueOverride=null;N.calcLast=y.calcLast;N.calcDependenciesLast=y.calcDependenciesLast;N.needsUpdated=true;N.calcCount++;if(N.formula){try{if(N.formula.charAt(0)=="="){N.formula=N.formula.substring(1)}var s;if(y.callStack){if(!N.formulaParser){N.formulaParser=k.Formula(y.cellHandler)}s=N.formulaParser}else{s=y.formulaParser}y.callStack++;s.setObj(N);N.result=s.parse(N.formula)}catch(u){N.result=u.toString()}y.callStack--;if(N.result&&N.cellType&&J.cellTypeHandlers[N.cellType]){N.result=J.cellTypeHandlers[N.cellType].call(N,N.result)}y.filterValue.call(N)}else{if(N.value&&N.cellType&&J.cellTypeHandlers[N.cellType]){N.result=J.cellTypeHandlers[N.cellType].call(N,N.value);y.filterValue.call(N)}else{if(N.value!=G&&N.value.charAt){L=y.s.cellStartingHandlers[N.value.charAt(0)];if(L){N.valueOverride=L.call(N,N.value)}else{L=y.s.cellEndHandlers[N.value.charAt(N.value.length-1)];if(L){N.valueOverride=L.call(N,N.value)}}}y.filterValue.call(N)}}}N.needsUpdated=false;N.state.pop();return(N.valueOverride!=G?N.valueOverride:N.value)},updateCellDependencies:function(){if((this.state||(this.state=[])).length){return}this.state.push("updatingDependencies");var K=this.dependencies||[];this.dependencies=[];var u=K.length-1;if(u>-1){do{var s=K[u],I=y.getTdLocation(s.td);s.calcDependenciesLast=0;y.updateCellValue.call(s);if(I.row>0&&I.col>0){y.updateCellDependencies.call(s)}}while(u--)}this.state.pop()},filterValue:function(){var s,u;if(this.result!=G){this.value=this.result.valueOf();u=this.result.html}else{if(typeof this.value=="string"&&this.value.length>0){s=J.encode(this.value)}}this.td.html(u||s||this.value)},cellHandler:{variable:function(){if(arguments.length){var K=arguments[0],u=arguments[1],L=y.s.formulaVariables,I,s;switch(K.toLowerCase()){case"true":s=new g(true);s.html="TRUE";return s;case"false":s=new g(false);s.html="FALSE";return s}if(I=L[K]&&!u){return I}else{if(I&&u){return I[u]}else{return""}}}},time:function(u,s){return a.fromString(u,s)},number:function(s){switch(typeof s){case"number":return s;case"string":if(!v(s)){return s*1}case"object":if(s.getMonth){return b.toCentury(s)}}return s},numberInverted:function(I){var u=y.cellHandler.number(I),s=new l(u.valueOf()*-1);if(u.html){s.html=u.html}return s},performMath:function(N,M,L){var K,I,O=true,s=true,Q=[],P,u=function(R){return R};switch(K=(typeof M.valueOf())){case"number":break;case"string":if(!v(M)){M*=1}else{O=false}break;case"object":if(M.getMonth){M=b.toCentury(M);u=b.get}else{O=false}break;default:O=false}switch(I=(typeof L.valueOf())){case"number":break;case"string":if(!v(L)){L*=1}else{s=false}break;case"object":if(L.getMonth){L=b.toCentury(L)}else{s=false}break;default:s=false}if(!O){Q.push("not a number: "+M);M=0}if(!s){Q.push("not a number: "+L);L=0}if(Q.length){}switch(N){case"+":P=M+L;break;case"-":P=M-L;break;case"/":P=M/L;if(P==Infinity||P==F){P=0}break;case"*":P=M*L;break;case"^":P=C.pow(M,L);break}return u(P)},cellValue:function(I){var u=d.parseLocation(I),s;s=y.cellHandler.createDependency.call(this,this.sheet,u);y.updateCellValue.call(s);return(s.valueOverride!=G?s.valueOverride:s.value)},createDependency:function(u,L){var I,K,s;if(!(I=y.spreadsheets[u])){return null}if(!(K=I[L.row])){return null}if(!(s=K[L.col])){return null}if(!s.dependencies){s.dependencies=[]}if(i.inArray(this,s.dependencies)<0){s.dependencies.push(this)}return s},cellRangeValue:function(s,u){s=d.parseLocation(s);u=d.parseLocation(u);var P=[],K=C.max(s.row,u.row),O=C.min(s.row,u.row),I=C.max(s.col,u.col),L=I,M=C.min(s.col,u.col),N;if(K>=O||I>=M){do{I=L;do{N=y.spreadsheets[this.sheet][K][I];y.cellHandler.createDependency.call(this,this.sheet,{row:K,col:I});P.unshift(y.updateCellValue.call(N))}while(I-->M)}while(K-->O);return P}return P},fixedCellValue:function(s){s=s.replace(/\$/g,"");return y.cellHandler.cellValue.call(this,s)},fixedCellRangeValue:function(u,s){u=u.replace(/\$/g,"");s=s.replace(/\$/g,"");return y.cellHandler.cellRangeValue.call(this,u,s)},remoteCellValue:function(u,K){var I=d.parseLocation(K),s=d.parseSheetLocation(u);y.cellHandler.createDependency.call(this,s,I);return y.updateCellValue(s,I.row,I.col)},remoteCellRangeValue:function(L,M,u){L=d.parseSheetLocation(L);M=d.parseLocation(M);u=d.parseLocation(u);var s=[];for(var K=M.row;K<=u.row;K++){for(var I=M.col;I<=u.col;I++){s.push(y.updateCellValue(L,K,I))}}return[s]},callFunction:function(I,u){I=I.toUpperCase();u=u||[];if(i.sheet.fn[I]){this.fnCount++;var s=i.sheet.fn[I].apply(this,u);return s}else{return J.error({error:"Function "+I+" Not Found"})}}},cellLookupHandlers:{fixedCellValue:function(s){return[y.sheet,d.parseLocation(s),d.parseLocation(s)]},fixedCellRangeValue:function(u,I,s){return[d.parseSheetLocation(u),d.parseLocation(I),d.parseLocation(s)]},cellValue:function(s){},cellRangeValue:function(u,I,s){return[y.sheet,d.parseLocation(I),d.parseLocation(s)]},remoteCellValue:function(s,u){return[y.sheet,d.parseLocation(u),d.parseLocation(u)]},remoteCellRangeValue:function(u,I,s){return[d.parseSheetLocation(u),d.parseLocation(I),d.parseLocation(s)]},callFunction:function(){if(arguments[0]=="VLOOKUP"||arguments[0]=="HLOOKUP"&&arguments[1]){if(arguments[1]&&arguments[1][1]){return arguments[1][1]}return[]}}},cellLookup:function(){var s=Formula(i.extend({},y.cellHandler,y.cellLookupHandlers));s.setObj(this);var I=s.parse(this.formula),K=[];for(var L=I[1].row;L<=I[2].row;L++){for(var u=I[1].col;u<=I[2].col;u++){K.push(y.getCell(L,u,I[0]))}}return K},calcLast:0,calcDependenciesLast:0,calc:function(s,I){s=s||y.i;if(y.readOnly[s]||y.isChanged(s)===false&&!I||!y.formulaParser){return false}y.calcLast=new m();var u=y.spreadsheetToArray(null,s);d.calc(s,u,y.updateCellValue);y.trigger("sheetCalculation",[{which:"spreadsheet",sheet:u,index:s}]);y.setChanged(false);return true},calcVisiblePos:{row:-1,col:-1},calcVisibleInit:function(P){P=P||y.i;y.calcLast=y.calcLast||new m();var u=y.spreadsheetToArray(null,P)||[],L=y.updateCellValue,I=c.min,K=J.initCalcRows,s=J.initCalcCols,N=I(u.length-1,K),Q,O,M={row:-1,col:-1};if(N>0){M.row=N;do{if(N>0&&(Q=u[N])!==undefined){M.col=O=I(Q.length-1,s);if(O>0){do{L.apply(Q[O])}while(O-->1)}}}while(N-->1)}this.calcVisiblePos=M;y.trigger("sheetCalculation",[{which:"spreadsheet",sheet:u,index:P}]);y.setChanged(false)},calcVisibleRow:function(s,U){U=U||y.i;var L=y.spreadsheetToArray(null,U)||[],u=s.scrolledArea.end,Q=y.updateCellValue,O=c.min,P=J.initCalcRows,I=J.initCalcCols,K=u.row+P,N=u.col+I,S=O(L.length-1,K),V,T,M=this.calcVisiblePos,R={row:S,col:M.col};if(S>0){do{if((V=L[S])!==undefined){T=O(V.length-1,N);if(T>0){do{Q.apply(V[T])}while(T-->1)}}}while(S-->M.row)}this.calcVisiblePos=R;y.trigger("sheetCalculation",[{which:"spreadsheet",sheet:L,index:U}]);y.setChanged(false)},calcVisibleCol:function(s,V){V=V||y.i;var L=y.spreadsheetToArray(null,V)||[],u=s.scrolledArea.end,Q=y.updateCellValue,O=c.min,P=J.initCalcRows,I=J.initCalcCols,K=u.row+P,N=u.col+I,S=O(L.length-1,K),W,U,T,M=this.calcVisiblePos,R={row:M.row,col:M.col};if(S>0){do{if(S>0&&(W=L[S])!==undefined){U=O(W.length-1,N);if((T=W[U])!==undefined){Q.apply(T)}}}while(S-->1)}this.calcVisiblePos=R;y.trigger("sheetCalculation",[{which:"spreadsheet",sheet:L,index:V}]);y.setChanged(false)},calcDependencies:function(I,u){I=I||new m();y.calcDependenciesLast=I;if(!u){var s=this;y.undo.createCells([this],function(K){y.trigger("sheetPreCalculation",[{which:"cell",cell:s}]);y.setDirty(true);y.setChanged(true);y.updateCellValue.call(s);y.updateCellDependencies.call(s);y.trigger("sheetCalculation",[{which:"cell",cell:s}]);return K})}else{y.trigger("sheetPreCalculation",[{which:"cell",cell:this}]);y.setDirty(true);y.setChanged(true);y.updateCellValue.call(this);y.updateCellDependencies.call(this);y.trigger("sheetCalculation",[{which:"cell",cell:this}])}},addSheet:function(s){s=s||{rows:25,cols:10};if(s){y.evt.cellEditAbandon();y.setDirty(true);y.controlFactory.sheetUI(y.obj.ui,i.sheet.makeTable(s),y.sheetCount);y.setActiveSheet(y.sheetCount);y.sheetCount++;y.sheetSyncSize();y.obj.pane().resizeScroll();y.trigger("sheetAdd",[y.i])}},deleteSheet:function(u){var L=u||y.i,K=y.controls.enclosures.toArray(),s;K.splice(L,1);y.obj.barHelper().remove();y.obj.enclosure().remove();y.controls.enclosures=i(K);y.obj.menus().remove();y.obj.tabContainer().children().eq(y.i).remove();y.spreadsheets.splice(L,1);y.controls.autoFiller.splice(L,1);y.controls.bar.helper.splice(L,1);y.controls.bar.corner.splice(L,1);y.controls.bar.x.controls.splice(L,1);y.controls.bar.x.handleFreeze.splice(L,1);y.controls.bar.x.controls.splice(L,1);y.controls.bar.x.menu.splice(L,1);if(y.controls.bar.x.menuParent&&y.controls.bar.x.menuParent[L]){y.controls.bar.x.menuParent.splice(L,1)}y.controls.bar.x.parent.splice(L,1);y.controls.bar.x.td.splice(L,1);y.controls.bar.y.controls.splice(L,1);y.controls.bar.y.handleFreeze.splice(L,1);y.controls.bar.y.controls.splice(L,1);y.controls.bar.y.menu.splice(L,1);if(y.controls.bar.y.menuParent&&y.controls.bar.y.menuParent[L]){y.controls.bar.y.menuParent.splice(L,1)}y.controls.bar.y.parent.splice(L,1);y.controls.bar.y.td.splice(L,1);y.controls.barMenuLeft.splice(L,1);y.controls.barMenuTop.splice(L,1);y.controls.barLeft.splice(L,1);y.controls.barTop.splice(L,1);y.controls.barTopParent.splice(L,1);y.controls.chart.splice(L,1);y.controls.tdMenu.splice(L,1);y.controls.enclosure.splice(L,1);y.controls.fullScreen=null;y.controls.inPlaceEdit.splice(L,1);y.controls.menus.splice(L,1);y.controls.menuLeft.splice(L,1);y.controls.menuRight.splice(L,1);y.controls.pane.splice(L,1);y.controls.tables.splice(L,1);y.controls.table.splice(L,1);for(s=L+1;s<y.controls.tab.length;++s){var I=y.controls.tab[s].get(0);I.i--}y.controls.tab.splice(L,1);y.controls.toggleHide.x.splice(L,1);y.controls.toggleHide.y.splice(L,1);y.readOnly.splice(L,1);y.i=0;y.sheetCount--;y.sheetCount=C.max(y.sheetCount,0);if(y.sheetCount==0){y.addSheet()}y.setActiveSheet(y.i);y.setDirty(true);y.setChanged(true);y.trigger("sheetDelete",[L])},deleteRow:function(L,u){var K,N,s,M,I=y.sheetSize();if(L){N=s=L}else{N=C.min(y.highlightedLast.start.row,y.highlightedLast.end.row);s=C.max(y.highlightedLast.start.row,y.highlightedLast.end.row)}M=(s-N)+1;if(N<1||I.cols<2||M>=I.rows){return}K=s;do{y.getTd(y.i,K,1).parent().remove()}while(N<K--);y.controls.bar.y.td[y.i].splice(N,M);y.spreadsheets[y.i].splice(N,M);y.refreshRowLabels(N);y.setChanged(true);y.offsetFormulas({row:N,col:0},{row:-M,col:0},false,true);y.setDirty(true);y.evt.cellEditAbandon();y.obj.pane().resizeScroll();y.trigger("sheetDeleteRow",K)},deleteColumn:function(N){var L,s,K,P,R=y.sheetSize();if(N){s=K=N}else{s=C.min(y.highlightedLast.start.col,y.highlightedLast.end.col);K=C.max(y.highlightedLast.start.col,y.highlightedLast.end.col)}P=(K-s)+1;if(s<1||R.cols<2||P>=R.cols){return}L=K;y.obj.barHelper().remove();do{var Q=y.obj.table(),u=y.col(Q[0],L),O=y.obj.barTop(L).remove(),M=u.tds,I=M.length-1;do{i(M[I]).remove()}while(I--);y.obj.barTop(L).remove();i(u).remove()}while(s<L--);y.controls.bar.x.td[y.i].splice(s,P);I=y.spreadsheets[y.i].length-P;do{y.spreadsheets[y.i][I].splice(s,P)}while(I-->1);y.refreshColumnLabels(s);y.setChanged(true);y.offsetFormulas({row:0,col:s},{row:0,col:-P},false,true);y.setDirty(true);y.evt.cellEditAbandon();y.obj.pane().resizeScroll();y.trigger("sheetDeleteColumn",L)},sheetTab:function(u,I){var s="";if(u){s=y.obj.table().attr("title")||y.msg.sheetTitleDefault.replace(/[{]index[}]/gi,y.i+1);if(I){I(s)}return s}else{if(y.isSheetEditable()&&J.editableNames){J.prompt(y.msg.newSheetTitle,function(K){if(!K){s=y.obj.table().attr("title");K=(s?s:y.msg.sheetTitleDefault.replace(/[{]index[}]/gi,y.i+1))}else{y.setDirty(true);y.obj.table().attr("title",K);y.obj.tab().html(K);s=K}if(I){I(i(n.createElement("div")).text(s).html())}},y.sheetTab(true));return null}}},tdNotVisible:function(u){var I=y.obj.pane(),K=u[0],R={top:0,bottom:I.clientHeight,left:0,right:I.clientWidth},O=u.width(),M=u.height(),P={top:K.offsetTop,bottom:K.offsetTop+M,left:K.offsetLeft,right:K.offsetLeft+O},s=u.parent();if(!K.col){return false}var Q=i(K.barTop).is(":hidden"),L=s.is(":hidden"),N={up:L,down:P.bottom>R.bottom&&M<=I.clientHeight,left:Q,right:P.right>R.right&&O<=I.clientWidth};if(N.up||N.down||N.left||N.right){return N}return false},followMe:function(I,s){I=I||y.obj.tdActive();if(!I.length){return}var K=y.obj.pane(),u=K.actionUI;y.setBusy(true);u.putTdInView(I[0]);y.setBusy(false);if(!s){y.autoFillerGoToTd(I)}},autoFillerGoToTd:function(K,u,s){if(!J.autoFiller){return}K=K||y.obj.tdActive();var L=K[0];if(L&&L.type=="cell"){u=u||L.clientHeight;s=s||L.clientWidth;if(!L.offsetHeight||!L.offsetWidth||!L.clientHeight||!L.clientWidth){y.autoFillerHide();return}var I=K.position();y.obj.autoFiller().show().css("top",((I.top+(u||K.height())-3)+"px")).css("left",((I.left+(s||K.width())-3)+"px"))}},autoFillerHide:function(){if(!J.autoFiller){return}y.obj.autoFiller().hide()},setActiveSheet:function(I){I=I||0;if(y.cellLast.row>0||y.cellLast.col>0){y.evt.cellEditDone();y.obj.formula().val("")}var u=y.obj.enclosures(),s=u.length-1,K;y.autoFillerHide();if(s>0){do{if(I!=s){K=u[s];K._scrollLeft=K._scrollLeft||K.scrollUI.scrollLeft;K._scrollTop=K._scrollTop||K.scrollUI.scrollTop;K.style.display="none"}}while(s-->0)}y.i=I;K=u[I];K.style.display="";y.themeRoller.tab.setActive();y.readOnly[I]=(K.table.className||"").match(/\breadonly\b/i)!=null;K.pane.resizeScroll(true);K.scrollUI.scrollLeft=K._scrollLeft||K.scrollUI.scrollLeft;K.scrollUI.scrollTop=K._scrollTop||K.scrollUI.scrollTop;K._scrollLeft=K._scrollTop=null;K.scrollUI.onscroll()},openSheet:function(I){var L=I.length-1,s=[],u=function(){y.setBusy(true);var Q=y.controlFactory.header(),P=y.controlFactory.ui(),M=y.controlFactory.sheetAdder(),N=y.controlFactory.tabContainer(),O;y.sheetCount=I.length-1;Q.ui=P;Q.tabContainer=N;P.header=Q;P.sheetAdder=M;P.tabContainer=N;N.header=Q;N.ui=P;J.parent.append(Q).append(P).append(M).append(N);for(O=0;O<I.length;O++){new K(y,O,P,I[O])}},K=function(R,N,Q,P){var O=this;this.i=N;this.ui=Q;this.table=P;this.isLast=(N==L);this.jS=R;if(i.sheet.max){var M=R.tableSize(P);if(M.rows>i.sheet.max||M.cols>i.sheet.max){R.trigger("sheetMaxSize",[P,N]);J.confirm(R.msg.maxSizeBrowserLimitationOnOpen,function(){O.load()})}else{this.load()}}else{this.load()}};K.prototype={load:function(){y.controlFactory.sheetUI(this.ui,this.table,this.i);y.sheetCount++;s.push(this.i);y.trigger("sheetOpened",[this.i]);if(this.isLast){this.loaded()}},loaded:function(){var N=this.jS,M=this.ui;N.resizableSheet(J.parent,{minWidth:J.parent.width()*0.1,minHeight:J.parent.height()*0.1,start:function(){N.setBusy(true);N.obj.enclosure().hide();M.sheetAdder.hide();M.tabContainer.hide()},stop:function(){N.obj.enclosure().show();M.sheetAdder.show();M.tabContainer.show();N.setBusy(false);N.sheetSyncSize();N.obj.pane().resizeScroll()}});N.sheetSyncSize();N.setActiveSheet(0);N.setDirty(false);N.setBusy(false);while(s.length){N.calcVisibleInit(N.i=s.pop())}N.trigger("sheetAllOpened")}};if(y.isDirty){J.confirm(y.msg.openSheet,u)}else{u()}},newSheet:function(){J.parent.html(i.sheet.makeTable()).sheet(J)},sheetSyncSize:function(){var L=J.parent[0].clientHeight;if(!L){L=400;J.parent.height(L)}else{if(L<200){L=200;J.parent.height(L)}}L-=y.obj.header().outerHeight();L-=y.obj.tabContainer().outerHeight()+y.s.boxModelCorrection;var u=J.parent[0].clientWidth,N=y.obj.ui.style,K=(L-k.scrollBarSize.height-J.boxModelCorrection)+"px",s=(u-k.scrollBarSize.width)+"px",M=L+"px",I=u+"px";y.obj.panes().each(function(){var Q=this.style,P=this.actionUI.scrollUI.style,O=this.enclosure.style;Q.height=K;Q.width=s;O.height=P.height=M;O.width=P.width=I});N.height=M;N.width=I},cellChangeStyle:function(I,K,s){s=s||y.highlighted(true);if(s.length<1){return false}y.setDirty(this);var u=s.length-1;if(u>=0){y.undo.createCells(s,function(L){do{L[u].td.css(I,K)}while(u--);return L});return true}return false},cellFind:function(s){function u(K){var I=y.obj.table().children("tbody").children("tr");if(K){var L=I.children('td:contains("'+K+'")');if(L.length<1){L=I.children('td:contains("'+K.toLowerCase()+'")')}if(L.length<1){L=I.children('td:contains("'+K.toUpperCase()+'")')}L=L.eq(0);if(L.length>0){y.cellEdit(L)}else{J.alert(y.msg.cellNoFind)}}}if(!s){J.prompt(y.msg.cellFind,u)}else{u(s)}},cellSetActiveBar:function(P,I,K){var U=y.sheetSize(),M=C.min(I,K),R=C.max(I,K),s={},Q={},T=function(V){switch(J.cellSelectModel){case"oo":this.row=(V?s.row:Q.row);this.col=(V?s.col:Q.col);this.td=y.getTd(y.i,this.row,this.col);if(!this.td.is(y.cellLast.td)){y.cellEdit(this.td,false,true)}break;default:this.row=(V?Q.row:s.row);this.col=(V?Q.col:s.col);this.td=y.getTd(y.i,this.row,this.col);if(!this.td.is(y.cellLast.td[0])){y.cellEdit(this.td,false,true)}break}},L=[],N=y.obj.pane().actionUI.scrolledArea,O=y.obj.table(),u,S;switch(P){case"top":s.row=N.end.row;s.col=M;Q.row=N.end.row;Q.col=R;y.highlightedLast.start.row=1;y.highlightedLast.start.col=M;y.highlightedLast.end.row=U.rows;y.highlightedLast.end.col=R;u=R;do{L.push(y.col(O[0],u))}while(u-->M);break;case"left":s.row=M;s.col=N.end.col;Q.row=R;Q.col=N.end.col;y.highlightedLast.start.row=M;y.highlightedLast.start.col=1;y.highlightedLast.end.row=R;y.highlightedLast.end.col=U.cols;S=R;do{L.push(y.getTd(y.i,S,1)[0].parentNode)}while(S-->M);break;case"corner":s.row=1;s.col=1;Q.col=U.cols;Q.row=U.rows;L.push(O[0]);break}new T(I>K);y.themeRoller.cell.setHighlighted(i(L))},getTdRange:function(K,P,N,O){y.cellLast.isEdit=true;var u=function(R){if(R.first.col>R.last.col||R.first.row>R.last.row){return{first:d.parseCellName(R.last.col,R.last.row),last:d.parseCellName(R.first.col,R.first.row)}}else{return{first:d.parseCellName(R.first.col,R.first.row),last:d.parseCellName(R.last.col,R.last.row)}}},M=function(U){var R=u(U),T=P+"";T=(T.match(/=/)?T:"="+T);if(N||T.charAt(T.length-1)!="("){T=T+(N?N:"")+"("}var V,S="";if(R.first!=R.last){V=R.first+":"+R.last}else{V=R.first}if(T.charAt(T.length-1)=="("){S=")"}return T+V+S},s="",I,L,Q;if(K){I={first:y.getTdLocation([K.target])};L=y.obj.table().mousemove(function(R){I.last=y.getTdLocation([R.target]);s=M(I);if(!O){y.obj.formula().val(s);y.obj.inPlaceEdit().val(s)}});w.one("mouseup",function(){L.unbind("mousemove");return s})}else{Q=y.highlighted().not(y.obj.tdActive());if(Q.length){I={first:y.getTdLocation(Q.first()),last:y.getTdLocation(Q.last())};s=M(I);if(!O){y.obj.formula().val(s);y.obj.inPlaceEdit().val(s)}return s}else{return""}}return""},getTd:function(L,N,u){var I=y.obj.tables()[L],s,K,M;if(!I||!(s=I.tBody)||!(K=s.children[N])||!(M=K.children[u])){M=n.createElement("td")}return i(M)},getTdLocation:function(u){var s={col:0,row:0};u=u||"";if(!u&&!u[0]){return s}u=u[0]||u;if(u.parentNode==G||u.parentNode.rowIndex<0){return s}return{col:parseInt(u.cellIndex),row:parseInt(u.parentNode.rowIndex)}},getBarIndex:{left:function(s){s=s||{};if(!s.parentNode||v(s.parentNode.rowIndex)){return -1}else{return s.parentNode.rowIndex}},top:function(s){s=s||{};if(v(s.cellIndex)){return -1}else{return s.cellIndex}},corner:function(){return 0}},time:{now:new m(),last:new m(),diff:function(){return C.abs(C.ceil(this.last.getTime()-this.now.getTime())/1000).toFixed(5)},set:function(){this.last=this.now;this.now=new m()},get:function(){return this.now.getHours()+":"+this.now.getMinutes()+":"+this.now.getSeconds()}},changed:[],isChanged:function(s){return y.changed[s||y.i]},setChanged:function(s){y.changed[y.i]=s},isDirty:false,setDirty:function(s){y.dirty=s},appendToFormula:function(s){var I=y.obj.formula(),u=I.val();if(u.charAt(0)!="="){u="="+u}I.val(u+s)},undo:{manager:(k.UndoManager?new UndoManager():{undo:E,redo:E,register:E,notLoaded:true}),cells:[],id:0,createCells:function(s,u,L){if(y.undo.manager.notLoaded){this.createCells=function(M,N,O){return N(M)};return this.createCells(s,u,L)}if(L==G){y.undo.id++;L=y.undo.id}var I=new t(s).clone().cells,K=(u?new t(u(s)).clone().cells:I);I.id=L;K.id=L;y.undo.manager.register(G,y.undo.removeCells,[I,L],"Remove Cells",G,y.undo.createCells,[K,null,L],"Create Cells");if(L!=y.undo.id||!u){y.calcLast=new m();y.undo.draw(K)}return true},removeCells:function(u,K){var I=0,s=-1;if(u.id===K){s=I}if(s!==-1){}y.undo.draw(u)},draw:function(I){var u;for(u=0;u<I.length;u++){var L=I[u],K=y.getTdLocation(L.td),s=y.spreadsheets[L.sheet][K.row][K.col];s.value=L.value;s.formula=L.formula;s.td=L.td;s.dependencies=L.dependencies;s.needsUpdated=L.needsUpdated;s.calcCount=L.calcCount;s.sheet=L.sheet;s.calcLast=L.calcLast;s.html=L.html;s.state=L.state;s.jS=L.jS;s.calcDependenciesLast=L.calcDependenciesLast;s.td.attr("style",L.style);s.td.attr("class",L.cl);y.updateCellValue.call(s)}}},cols:function(s){s=s||y.obj.table()[0];if(!s){return[]}if(!s.colGroup){return[]}if(!s.colGroup.children){return[]}return s.colGroup.children},tables:function(Q,L){Q=Q||y.obj.tables();var P=[],I=Q.length-1,u,S,O,s,T,K,R,M,N;do{S=(L?n.body.removeChild(Q[I]):Q[I].cloneNode(true));if((s=S.children[0])&&(T=s.children[0])){s.removeChild(T)}if(O=S.children[1]){M=O.children;R=M[0];O.removeChild(R);u=M.length-1;do{N=M[u];K=N.children[0];N.removeChild(K)}while(u-->0)}P[I]=S}while(I-->0);return y.sheetDecorateRemove(false,i(P))},col:function(u,s){u=u||y.obj.table()[0];var I=y.cols(u);if(s===G){s=I.length-1}return I[s]},rowTds:function(u,s){u=u||y.obj.table();var I=y.rows(u);if(!I.length){return[]}if(s==G){s=I.length-1}if(!I[s]){return[]}if(!I[s].children){return[]}return I[s].children},rows:function(s){s=s||y.obj.table()[0];if(!s){return[]}if(!s.tBody){return[]}if(!s.tBody.children){return[]}return s.tBody.children},highlighted:function(u){var K=y.highlightedLast.obj||i([]),L=[],s,I;if(!(s=K)||!K.length||!(s=s[0])||!s.tagName){return u?L:i(L)}switch(s.tagName){case"TD":I=K.length-1;do{L.unshift(u?K[I].jSCell:K[I])}while(I-->0);break;case"TR":I=K.length-1;do{if(K[I].tds){L=L.concat(u?K[I].jSCells:K[I].tds)}}while(I-->0);break;case"COL":K=K.filter("col");I=K.length-1;do{if(K[I].tds){L=L.concat(u?K[I].jSCells:K[I].tds)}}while(I-->0);break;case"TABLE":L=(u?s.jSCells:s.tds);break}return u?L:i(L)},sheetSize:function(u){u=u||y.obj.table()[0];var s=y.rowTds(u),I=y.getTdLocation(s[s.length-1]);return{cols:I.col,rows:I.row}},test:function(){var u=y.highlighted(true);console.log(y.obj.enclosure())},sortVerticalSelectAscending:function(){if(confirm("Do you want to extend your selection?")){y.sortVertical();return true}else{y.sortVerticalSingle(false);return true}},sortVerticalSelectDescending:function(){if(confirm("Do you want to extend your selection?")){y.sortVertical();return false}else{y.sortVerticalSingle(true);return false}},sortVertical:function(Q){var O=y.highlighted(true),L=O[0].td.parent().prev(),s=O.length,I=new m(),N=true,R=[],T=[],M,P=0,S,u,K;while(P<s){S=O[P];K=S.td[0];if(!isNaN(S.value)){u=(new l(S.value.valueOf()))}else{N=false;u=(new o(S.value.valueOf()))}u.loc=y.getTdLocation(K);u.row=K.parentNode;u.col=K;u.cell=S;R.push(u);P++}if(Q){if(N==false){R.sort(function(V,U){return U-V})}else{R.sort();R.reverse()}}else{if(N==true){R.sort(function(V,U){return V-U})}else{R.sort()}}y.undo.createCells(O);while(M=R.length){u=R.pop();T=y.spreadsheets[y.i].splice(u.row.rowIndex,1);S=u.cell;S.value=u.valueOf();S.calcLast=0;u.row.parentNode.removeChild(u.row);L.after(u.row);u.row.children[0].innerHTML=L[0].rowIndex+M;y.spreadsheets[y.i].splice(L[0].rowIndex+1,0,T[0]);y.calcDependencies.call(S,I,true)}y.undo.createCells(O)},sortVerticalSingle:function(M){var K=y.highlighted(true),L=K.length,I=0,u=[],s;while(I<L){u.push(K[I].value);I++}if(M){u.sort(function(O,N){return N-O})}else{u.sort(function(O,N){return O-N})}while(K.length){s=K.pop();s.value=u[K.length];s.calcLast=0;y.updateCellValue.call(s);y.updateCellDependencies.call(s)}},sortHorizontalSelectAscending:function(){if(confirm("Do you want to extend your selection?")){y.sortHorizontal();return true}else{y.sortHorizontalSingle(false);return true}},sortHorizontalSelectDescending:function(){if(confirm("Do you want to extend your selection?")){y.sortHorizontal();return false}else{y.sortHorizontalSingle(true);return false}},sortHorizontal:function(Q){var O=y.highlighted(true),W=O[0].td[0],S=W.cellIndex,s=W.table.colGroup,X=y.sheetSize().rows,u=O.length,K=new m(),N=true,T=[],M,P=0,U,V,I,R,L;while(P<u){U=0;V=O[P];L=V.td[0];if(!isNaN(V.value)){I=new l(V.value.valueOf())}else{N=false;I=new o(V.value.valueOf())}I.tds=[];I.loc=y.getTdLocation(L);I.tr=L.parentNode;I.td=L;I.cell=V;while(U<=X){I.tds.push(y.obj.pane().table.children[1].children[U].children[L.cellIndex]);U++}T.push(I);P++}if(Q){if(N==false){T.sort(function(Z,Y){return Y-Z})}else{T.sort();T.reverse()}}else{if(N==true){T.sort(function(Z,Y){return Z-Y})}else{T.sort()}}y.undo.createCells(O);while(T.length){I=T.pop();while(I.tds.length>1){L=I.tds.pop();R=L.parentNode;V=y.spreadsheets[y.i][R.rowIndex].splice(L.cellIndex,1);R.insertBefore(L,R.children[S]);L.col=s.children[T.length+L.cellIndex-1];L.barTop=L.col.bar;V.value=L.jSCell.value;V.calcLast=K;y.spreadsheets[y.i][R.rowIndex].splice(L.cellIndex,0,V[0]);y.calcDependencies.call(V,K,true)}}y.undo.createCells(O)},sortHorizontalSingle:function(M){var K=y.highlighted(true),L=K.length,I=0,u=[],s;while(I<L){u.push(K[I].value);I++}if(M){u.sort(function(O,N){return N-O})}else{u.sort(function(O,N){return O-N})}while(K.length){s=K.pop();s.value=u[K.length];s.calcLast=0;y.updateCellValue.call(s);y.updateCellDependencies.call(s)}},tableSize:function(I){I=I||y.obj.table()[0];var s=(I.children[0].nodeName!="TBODY"?I.children[1]:I.children[0]).children,u=s[s.length-1].children,L=u[u.length-1],K=y.getTdLocation(L);return{cols:K.col,rows:K.row}},toggleState:function(s){if(J.allowToggleState){var u=s||y.tables();if(J.editable){y.evt.cellEditAbandon();y.trigger("sheetSave",[u])}y.setDirty(false);y.setChanged(true);J.editable=!J.editable;y.kill();J.parent.html(u).sheet(J);J=null}},setCellRef:function(u){function s(L){if(L){y.s.formulaVariables[L]=y.updateCellValue(y.i,I.row,I.col)}}var K=y.obj.tdActive(),I=y.getTdLocation(K);if(u){s(u)}else{J.prompt(y.msg.setCellRef,s)}},formulaParser:null};y.setBusy(true);J.parent[0].jS=y;if(!k.console){k.console={log:function(){}}}if(!k.scrollBarSize){k.scrollBarSize=i.sheet.getScrollBarSize()}if(k.Formula){y.formulaParser=k.Formula(y.cellHandler)}J.origHtml=J.parent.children().detach();J.parent.addClass(y.cl.parent);J.parent.bind("sheetSwitch",function(I,u,s){y.switchSheet(s)}).bind("sheetRename",function(I,u,s){y.renameSheet(s)});J.width=(J.width?J.width:J.parent.width());J.height=(J.height?J.height:J.parent.height());if(!i.nearest){y.nearest=E}y.resizableCells=y.resizableSheet=y.resizable;if(!i.ui){y.resizable=y.resizableCells=y.resizableSheet=y.draggable=E}else{if(!J.resizableCells){y.resizableCells=E}if(!J.resizableSheet){y.resizableSheet=E}}if(!i.support.boxModel){J.boxModelCorrection=0}if(!J.barMenus){y.controlFactory.barMenuTop=y.controlFactory.barMenuLeft=E}if(!J.freezableCells){y.controlFactory.barHandleFreeze.top=y.controlFactory.barHandleFreeze.left=E}if(J.calcOff){y.calc=E}if(!k.Raphael){d.chart=E}r.resize(function(){if(y&&!y.isBusy()){J.width=J.parent.width();J.height=J.parent.height();y.sheetSyncSize()}});if(i.sheet.fn){i.sheet.fn=i.extend(i.sheet.fn,J.formulaFunctions);if(i.sheet.advancedfn){i.sheet.fn=i.extend(i.sheet.fn,i.sheet.advancedfn)}if(i.sheet.financefn){i.sheet.fn=i.extend(i.sheet.fn,i.sheet.financefn)}}J.title=J.title||J.parent.attr("title")||"";y.s=J;J.parent.addClass(y.cl.uiParent);if(J.origHtml.length){y.openSheet(J.origHtml)}else{y.openSheet(i(n.createElement("table")))}y.setBusy(false);return y},makeTable:function(D,t,r){var B=n;D=D||{rows:25,cols:10};t=t||120;r=r||15;var C=n.createElement("table"),s=n.createElement("colgroup"),A=n.createElement("tbody"),x="width:"+t+"px;",v="height:"+r+"px;",z,u,y,w;y=D.cols;do{u=n.createElement("col");u.setAttribute("style",x);s.appendChild(u)}while(y-->1);y=D.rows;do{z=n.createElement("tr");z.setAttribute("style",v);w=D.cols;do{z.appendChild(n.createElement("td"))}while(w-->1);A.appendChild(z)}while(y-->1);C.appendChild(s);C.appendChild(A);return C},killAll:function(){if(i.sheet){var r=i.sheet.instance;if(r){for(var s=0;s<r.length;s++){if(r[s]&&r[s].kill){r[s].kill()}}i.sheet.instance=[]}}},scrollLocker:function(s){var r=i.sheet.instance;r[s].obj.panes().each(function(t){var u;i(u=this.scrollUI).scroll(function(w){var v=r.length-1,x;if(v>-1){do{x=r[v].controls.enclosure[t][0].scrollUI;if(this!==x){x.scrollLeft=u.scrollLeft;x.scrollTop=u.scrollTop}}while(v--)}})})},switchSheetLocker:function(r){i.each(i.sheet.instance,function(){this.s.parent.bind("sheetSwitch",function(u,t,s){i.each(i.sheet.instance,function(){this.setActiveSheet(s)})})})},I:function(){var r=0;if(this.instance){r=(this.instance.length===0?0:this.instance.length-1)}else{this.instance=[]}return r},getScrollBarSize:function(){var x=n,A=i(n.createElement("p")).css({width:"100%",height:"100%"}),z=i(n.createElement("div")).css({position:"absolute",width:"100px",height:"100px",top:"0",left:"0",visibility:"hidden",overflow:"hidden"}).append(A);i(n.body).append(z);var t=A.width(),v=A.height();z.css("overflow","scroll");var r=A.width(),u=A.height();if(t==r&&z[0].clientWidth){r=z[0].clientWidth}if(v==u&&z[0].clientHeight){u=z[0].clientHeight}z.detach();var y=t-r,s=v-u;return{width:y||15,height:s||15}},debugPositionBox:function(r,w,t,s,v){s=s||"#"+c.floor(c.random()*16777215).toString(16);if(t){var u=i([]);u=u.add(this.debugPositionBox(t.left,t.top,null,s,"top-left"));u=u.add(this.debugPositionBox(t.right,t.top,null,s,"top-right"));u=u.add(this.debugPositionBox(t.left,t.bottom,null,s,"bottom-left"));u=u.add(this.debugPositionBox(t.right,t.bottom,null,s,"bottom-right"));return u}return i('<div style="width: 10px; height: 10px; position: absolute;"></div>').css("top",(w-5)+"px").css("left",(r+5)+"px").css("background-color",s).click(function(){console.log(v||"none")}).appendTo("body")}};var d=i.sheet.engine={calc:function(t,r,u){r=r||[];var v=r.length-1,s;if(v>0){do{if(v>0&&r[v]){s=r[v].length-1;if(s>0){do{u(t,v,s)}while(s--)}}}while(v--)}},parseLocation:function(s){for(var r=0;r<s.length;r++){if(s.charCodeAt(r)<=57){break}}return{row:parseInt(s.substring(r)),col:d.columnLabelIndex(s.substring(0,r))}},parseSheetLocation:function(r){return((r+"").replace("SHEET","")*1)-1},parseCellName:function(r,s){return d.columnLabelString(r)+(s||"")},alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),columnLabels:{},columnLabelIndex:function(r){return this.columnLabels[r.toUpperCase()]},columnIndexes:[],columnLabelString:function(v){if(!this.columnIndexes.length){var x="",w,u,t,r;w=u=t=-1;for(r=1;r<16385;++r){x="";++t;if(t==26){t=0;++u;if(u==26){u=0;++w}}if(w>=0){x+=this.alphabet[w]}if(u>=0){x+=this.alphabet[u]}if(t>=0){x+=this.alphabet[t]}this.columnIndexes[r]=x;this.columnLabels[x]=r}}return this.columnIndexes[v]||""},regEx:{n:/[\$,\s]/g,cell:/\$?([a-zA-Z]+|[#]REF[!])\$?([0-9]+|[#]REF[!])/gi,range:/\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCell:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCellRange:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,sheet:/SHEET/i,amp:/&/g,gt:/</g,lt:/>/g,nbsp:/&nbsp;/g},chart:function(u){var t=this.jS,r=this;function s(w,x){if(!w){if(x){w=0}else{w=""}}else{if(x){w=f.toNumbers(w)}else{w=f.flatten(w)}}return w}u=i.extend({x:{legend:"",data:[0]},y:{legend:"",data:[0]},title:"",data:[0],legend:"",td:this.td,chart:i(n.createElement("div")).addClass(t.cl.chart).mousedown(function(){u.td.mousedown()}),gR:{}},u);t.controls.chart[t.i]=t.obj.chart().add(u.chart);u.data=s(u.data,true);u.x.data=s(u.x.data,true);u.y.data=s(u.y.data,true);u.legend=s(u.legend);u.x.legend=s(u.x.legend);u.y.legend=s(u.y.legend);u.legend=(u.legend?u.legend:u.data);t.s.parent.one("sheetCalculation",function(){var w=u.chart.width(),v=u.chart.height(),x=Raphael(u.chart[0]);if(u.title){x.text(w/2,10,u.title).attr({"font-size":20})}switch(u.type){case"bar":u.gR=x.barchart(w/8,v/8,w*0.8,v*0.8,u.data,u.legend).hover(function(){this.flag=x.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"hbar":u.gR=x.hbarchart(w/8,v/8,w*0.8,v*0.8,u.data,u.legend).hover(function(){this.flag=x.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"line":u.gR=x.linechart(w/8,v/8,w*0.8,v*0.8,u.x.data,u.y.data,{nostroke:false,axis:"0 0 1 1",symbol:"circle",smooth:true}).hoverColumn(function(){this.tags=x.set();if(this.symbols.length){for(var y=0,z=this.y.length;y<z;y++){this.tags.push(x.tag(this.x,this.y[y],this.values[y],160,10).insertBefore(this).attr([{fill:"#fff"},{fill:this.symbols[y].attr("fill")}]))}}},function(){this.tags&&this.tags.remove()});break;case"pie":u.gR=x.piechart(w/2,v/2,(w<v?w:v)/2,u.data,{legend:u.legend}).hover(function(){this.sector.stop();this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label){this.label[0].stop();this.label[0].attr({r:7.5});this.label[1].attr({"font-weight":800})}},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce");if(this.label){this.label[0].animate({r:5},500,"bounce");this.label[1].attr({"font-weight":400})}});break;case"dot":u.gR=x.dotchart(w/8,v/8,w*0.8,v*0.8,u.x.data,u.y.data,u.data,{symbol:"o",max:10,heat:true,axis:"0 0 1 1",axisxstep:u.x.data.length-1,axisystep:u.y.data.length-1,axisxlabels:(u.x.legend?u.x.legend:u.x.data),axisylabels:(u.y.legend?u.y.legend:u.y.data),axisxtype:" ",axisytype:" "}).hover(function(){this.marker=this.marker||x.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this);this.marker.show()},function(){this.marker&&this.marker.hide()});break}u.gR.mousedown(function(){u.td.mousedown().mouseup()});u.chart.mousemove(function(){u.td.mousemove();return false})});return u.chart}};var e=i.sheet.fn={ISNUMBER:function(s){var r;if(!isNaN(s.valueOf())){r=new g(true);r.html="TRUE";return r}r=new g(false);r.html="FALSE";return r},N:function(r){if(r==null){return 0}if(r instanceof m){return r.getTime()}if(typeof(r)=="object"){r=r.toString()}if(typeof(r)=="string"){r=parseFloat(r.replace(d.regEx.n,""))}if(isNaN(r)){return 0}if(typeof(r)=="number"){return r}if(r==true){return 1}return 0},VERSION:function(){return this.jS.version},ABS:function(r){return c.abs(e.N(r))},CEILING:function(s,r){r=r||1;return(parseInt(s/r)*r)+r},EVEN:function(r){r=c.round(r);var s=(r%2==0);if(!s){if(r>0){r++}else{r--}}return r},EXP:function(r){return c.exp(r)},FLOOR:function(t,s){s=s||1;if((t<0&&s>0)||(t>0&&s<0)){var r=new l(0);r.html="#NUM";return r}if(t>=0){return c.floor(t/s)*s}else{return c.ceil(t/s)*s}},INT:function(r){return c.floor(e.N(r))},LN:function(r){return c.log(r)},LOG:function(r,s){s=s||10;return c.log(r)/c.log(s)},LOG10:function(r){return e.LOG(r)},MOD:function(r,t){var s=r%t;if(t<0){s*=-1}return s},ODD:function(r){var t=false;if(r>0){r=c.floor(c.round(r));t=true}else{r=c.ceil(r)}var s=c.abs(r);if((s%2)==0){s++}if(t){return s}else{return -s}},PI:function(){return c.PI},POWER:function(r,s){return c.pow(r,s)},SQRT:function(r){return c.sqrt(r)},RAND:function(){return c.random()},RND:function(){return c.random()},ROUND:function(t,s){var r=c.pow(10,s||0);return c.round(t*r)/r},ROUNDDOWN:function(s,r){var t=(s<0);s=c.abs(s);r=r||0;s=c.floor(s*c.pow(10,r))/c.pow(10,r);return(t?-s:s)},ROUNDUP:function(s,r){var t=(s<0);s=c.abs(s);r=r||0;s=c.ceil(s*c.pow(10,r))/c.pow(10,r);return(t?-s:s)},SUM:function(){var t=0,r=f.toNumbers(arguments),s=r.length-1;if(s<0){return 0}do{t+=r[s]*1}while(s--);return t},TRUNC:function(r,s){s=s||0;r=r+"";if(s==0){return r.split(".").shift()}if(r.match(".")){if(s==1){r=r.substr(0,r.length-1)}else{if(s==-1){r=r.split(".").shift();r=r.substr(0,r.length-1)+"0"}}}return r},AVERAGE:function(r){return e.SUM(arguments)/e.COUNT(arguments)},AVG:function(r){return e.AVERAGE(r)},COUNT:function(){var t=0,r=f.toNumbers(arguments),s=r.length-1;if(s<0){return t}do{if(r[s]!==null){t++}}while(s--);return t},COUNTA:function(){var t=0,r=f.flatten(arguments),s=r.length-1;if(s<0){return t}do{if(r[s]){t++}}while(s--);return t},MAX:function(){var s=f.toNumbers(arguments),r=s[0],t=s.length-1;if(t<0){return 0}do{r=(s[t]>r?s[t]:r)}while(t--);return r},MIN:function(){var r=f.toNumbers(arguments),t=r[0],s=r.length-1;if(s<0){return 0}do{t=(r[s]<t?r[s]:t)}while(s--);return t},ASC:function(r){return r.charCodeAt(0)},CHAR:function(r){return o.fromCharCode(r)},CLEAN:function(r){var s=new q("[cG\x1BcLcJcMcIcK\x07\x1B\f\n\r\t\v]","g");return r.replace(s,"")},CODE:function(r){return e.ASC(r)},CONCATENATE:function(){var t=f.flatten(arguments),s="",r=this;jQuery.each(t,function(u){s+=t[u]});return s},DOLLAR:function(u,t,x){t=t||2;x=x||"$";var s=new l(u),w=e.FIXED(u,t,false);if(u>=0){s.html=x+w}else{s.html="("+x+w.slice(1)+")"}return s},FIXED:function(u,t,s){t=(t===undefined?2:t);var w=c.pow(10,t),r,u=c.round(u*w)/w;r=new o(u.toFixed(t));r.html=Globalize.format(u,"n"+t);if(s){r.html=r.html.replace(Globalize.culture().numberFormat[","],"")}return r},LEFT:function(r,s){s=s||1;return r.substring(0,s)},LEN:function(r){if(!r){return 0}return r.length},LOWER:function(r){return r.toLowerCase()},MID:function(s,t,r){if(!s||!t||!r){return this.jS.s.error({error:"ERROR"})}return s.substring(t-1,r+t-1)},REPLACE:function(s,v,t,u){if(!s||!v||!t||!u){return this.jS.s.error({error:"ERROR"})}var r=s.split("");r.splice(v-1,t);r.splice(v-1,0,u);return r.join("")},REPT:function(s,u){var r="";for(var t=0;t<u;t++){r+=s}return r},RIGHT:function(r,s){s=s||1;return r.substring(r.length-s,r.length)},SEARCH:function(t,r,u){u=u||0;if(u){r=r.split("");r.splice(0,u-1);r=r.join("")}var s=r.search(t);if(s<0){return this.jS.s.error({error:"#VALUE!"})}return u+(u?0:1)+s},SUBSTITUTE:function(u,r,t,v){v=v||0;r=new q(r,"g");var s=1;u=u.replace(r,function(x,z,A,y){var w=x;if(v){if(s>=v){w=t}}else{w=t}s++;return w});return u},TEXT:function(){return this.jS.s.error({error:"Not Yet Implemented"})},UPPER:function(r){return r.toUpperCase()},VALUE:function(r){if(jQuery.isNumeric(r)){return r*=1}else{return this.jS.s.error({error:"#VALUE!"})}},NOW:function(){var r=new m();r.html=b.toString(r);return r},TODAY:function(){var s=new m(),r=new l(b.toCentury(s)-1);r.html=b.toString(s,"d");return r},WEEKENDING:function(s){var r=new m();r=new m(r.getFullYear(),r.getMonth(),r.getDate()+5-r.getDay()-((s||0)*7));r.html=b.toString(r,"d");return r},WEEKDAY:function(s,t){s=b.get(s);var r=s.getDay();t=(t?t:1);switch(t){case 3:switch(r){case 0:return 7;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6}break;case 2:switch(r){case 0:return 6;case 1:return 0;case 2:return 1;case 3:return 2;case 4:return 3;case 5:return 4;case 6:return 5}break;case 1:r++;break}return r},WEEKNUM:function(r){r=b.get(r);return b.week(r)+1},YEAR:function(r){r=b.get(r);return r.getFullYear()},DAYSFROM:function(s,t,r){return c.floor((new m()-new m(s,(t-1),r))/b.dayDiv)},DAYS:function(v,t){var s=b.get(v),r=b.get(t),u=1000*60*60*24;return c.round(c.abs(s.getTime()-r.getTime())/u)},DAY:function(r){r=b.get(r);return r.getDate()},DAYS360:function(w,t,y){w=b.get(w);t=b.get(t);var r=w.getDate(),v=t.getDate(),u=b.isLastDayOfMonth(w),x=b.isLastDayOfMonth(t),s=b.diffMonths(w,t);if(y){r=c.min(r,30);v=c.min(v,30)}else{if(u){r=30}if(x){if(r<30){s++;v=1}else{v=30}}}return(s*30)+(v-r)},DATE:function(u,v,s){var t=new m(u,v-1,s),r=new l(b.toCentury(t));r.html=b.toString(t,"d");return r},DATEVALUE:function(s){s=b.get(s);var r=new l(b.toCentury(s));r.html=b.toString(s,"d");return r},EDATE:function(t,s){t=b.get(t);t.setMonth(t.getMonth()+s);var r=new l(b.toCentury(t));r.html=b.toString(t,"d");return r},EOMONTH:function(t,s){t=b.get(t);t.setMonth(t.getMonth()+s+1);t=new m(t.getFullYear(),t.getMonth(),0);var r=new l(b.toCentury(t));r.html=b.toString(t,"d");return r},HOUR:function(r){r=a.fromMath(r);return r.hour},MINUTE:function(r){return a.fromMath(r).minute},MONTH:function(r){r=b.get(r);return r.getMonth()+1},SECOND:function(r){return a.fromMath(r).second},TIME:function(r,w,s){s=(s?s:0);w=(w?w:0);r=(r?r:0);if(s&&s>60){var t=(((s/60)+"").split(".")[0])*1;s=s-(t*60);w+=t}if(w&&w>60){var v=(((w/60)+"").split(".")[0])*1;w=w-(v*60);r+=v}var u=(r*60*60*1000)+(w*60*1000)+(s*1000);return u/b.dayDiv},TIMEVALUE:function(r){if(!isNaN(r)){return r}if(/([0]?[1-9]|1[0-2])[:][0-5][0-9]([:][0-5][0-9])?[ ]?(AM|am|aM|Am|PM|pm|pM|Pm)/.test(r)){return a.fromString(r,true)}else{if(/([0]?[0-9]|1[0-9]|2[0-3])[:][0-5][0-9]([:][0-5][0-9])?/.test(r)){return a.fromString(r)}}return 0},WORKDAY:function(s,v,u){var w={1:true,2:true,3:true,4:true,5:true},s=b.get(s),v=(v&&!isNaN(v)?v:0),x=0,t=0,r=s,z;if(u){if(!jQuery.isArray(u)){u=[u]}u=f.flatten(u);var y={};jQuery.each(u,function(A){if(u[A]){y[b.toString(b.get(u[A]),"d")]=true}});u=y}else{u={}}while(t<v){r=new m(r.setDate(r.getDate()+1));if(w[r.getDay()]){if(!u[b.toString(r,"d")]){t++}}x++}z=new l(b.toCentury(r));z.html=b.toString(r,"d");return z},YEARFRAC:function(r,v,u){r=b.get(r);v=b.get(v);if(!r||!v){return this.jS.s.error({error:"#VALUE!"})}u=(u?u:0);this.html=[];var t=b.diff(r,v,u),s=b.calcAnnualBasis(r,v,u);return t/s},AND:function(){var s=arguments,t,r=this;i.each(s,function(u){if(s[u].valueOf()!==true&&t==undefined){t=e.FALSE()}});if(!t){t=e.TRUE()}return t},FALSE:function(){var r=new g(false);r.html="FALSE";return r},IF:function(t,s,r){if(t.valueOf()){return s}else{return r}},NOT:function(s){var r;if(!s.valueOf()){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},OR:function(){var t=arguments,r,u=t.length-1,s;if(u>-1){do{s=t[u].valueOf();if(s){r=new g(true);r.html="TRUE";return r}}while(u--)}r=new g(false);r.html="FALSE";return r},TRUE:function(){var r=new g(true);r.html="TRUE";return r},GREATER:function(t,s){var r;if(t>s){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},LESS:function(t,s){var r;if(t<s){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},EQUAL:function(t,s){var r;if(t.valueOf()==s.valueOf()){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},GREATER_EQUAL:function(t,s){var r;if(t>=s){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},LESS_EQUAL:function(t,s){var r;if(t<=s){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},IMG:function(s){var r=new o("");r.html=i(n.createElement("img")).attr("src",s);return r},TRIM:function(r){if(typeof(r)=="string"){r=i.trim(r)}return r},HYPERLINK:function(t,s){s=s||"LINK";var r=new o(s);r.html=i(n.createElement("a")).attr("href",t).attr("target","_new").text(s);return r},DROPDOWN:function(){var B=this,x=this.jS,A,w=this.td.children().detach(),y,t=i(B.td),z,s,C;if(!w.length||B.needsUpdated){A=f.flatten(arguments);A=f.unique(A);y=x.getTdLocation(B.td);s="dropdown"+this.sheet+"_"+y.row+"_"+y.col+"_"+x.I;z=n.createElement("select");z.setAttribute("name",s);z.setAttribute("id",s);z.className="jSDropdown";z.cell=this;z.onmouseup=function(){x.cellEdit(t)};z.onchange=function(){B.value=this.value;x.calcDependencies.call(B,B.calcDependenciesLast)};x.controls.inputs[x.i]=x.obj.inputs().add(z);for(var u=0;u<(A.length<=50?A.length:50);u++){if(A[u]){var r=n.createElement("option");r.setAttribute("value",A[u]);r.text=r.innerText=A[u];z.appendChild(r)}}if(!x.s.editable){z.setAttribute("disabled",true)}else{x.s.parent.bind("sheetKill",function(){t.text(B.value=z.value)})}z.value=B.value||A[0];z.onchange()}if(typeof B.value!="object"){C=new o(B.value)}C.html=z;return C},RADIO:function(){var E=this,y=this.jS,D,x=this.td.children().detach(),A,t,z,r,u,s,F;if(!x.length||E.needsUpdated){D=f.flatten(arguments);D=f.unique(D);A=y.getTdLocation(E.td);t=i(E.td);z=[];s="radio"+this.sheet+"_"+A.row+"_"+A.col+"_"+y.I;u=n.createElement("span");u.className="jSRadio";u.onmousedown=function(){y.cellEdit(t)};u.jSCell=E;y.controls.inputs[y.i]=y.obj.inputs().add(u);for(var w=0;w<(D.length<=25?D.length:25);w++){if(D[w]){var C=n.createElement("input"),B=n.createElement("span");C.setAttribute("type","radio");C.setAttribute("name",s);C.className=s;C.value=D[w];C.onchange=function(){E.value=jQuery(this).val();y.calcDependencies.call(E,E.calcDependenciesLast)};z.push(C);if(D[w]==E.value){C.setAttribute("checked","true");C.onchange()}B.textContent=B.innerText=D[w];u.appendChild(C);u.input=C;B.onclick=function(){i(this).prev().click()};u.appendChild(B);u.appendChild(n.createElement("br"))}}r=i(z);if(!y.s.editable){E.value=r.filter(":checked").val();r.attr("disabled",true)}else{y.s.parent.bind("sheetKill",function(){E.value=r.filter(":checked").val();t.text(E.value)})}}if(typeof E.value!="object"){F=new o(E.value)}F.html=u;return F},CHECKBOX:function(z){if(i.isArray(z)){z=z[0]}var A=this,u=this.jS,t=this.td.children().detach(),x,w,s,y,r,B;if((!t.length||A.needsUpdated)){x=u.getTdLocation(A.td);w=i([]);s=i(A.td);r="checkbox"+this.sheet+"_"+x.row+"_"+x.col+"_"+u.I;w=n.createElement("input");w.setAttribute("type","checkbox");w.setAttribute("name",r);w.className=r;w.value=z;w.onchange=function(){if(i(this).is(":checked")){A.value=z}else{A.value=""}u.calcDependencies.call(A,A.calcDependenciesLast)};if(!u.s.editable){w.setAttribute("disabled","true")}else{u.s.parent.bind("sheetKill",function(){A.value=(A.value=="true"||i(w).is(":checked")?z:"");s.text(A.value)})}t=n.createElement("span");t.className="SCheckbox";t.appendChild(w);y=n.createElement("span");y.textContent=y.innerText=z;t.appendChild(y);t.appendChild(n.createElement("br"));t.onmousedown=function(){u.cellEdit(s)};t.cell=A;u.controls.inputs[u.i]=u.obj.inputs().add(t);if(z==A.value){w.setAttribute("checked",true);w.onchange()}}B=new o(A.value=="true"||i(w).is(":checked")?z:"");B.html=t;return B},BARCHART:function(s,t,u){var r=new o("");r.html=d.chart.call(this,{type:"bar",data:s,legend:t,title:u});return r},HBARCHART:function(s,t,u){var r=new o("");r.html=d.chart.call(this,{type:"hbar",data:s,legend:t,title:u});return r},LINECHART:function(t,s){var r=new o("");r.html=d.chart.call(this,{type:"line",x:{data:t},y:{data:s},title:""});return r},PIECHART:function(s,t,u){var r=new o("");r.html=d.chart.call(this,{type:"pie",data:s,legend:t,title:u});return r},DOTCHART:function(x,v,s,u,t,w){var r=new o("");r.html=d.chart.call(this,{type:"dot",data:(s?s:x),x:{data:x,legend:u},y:{data:(v?v:x),legend:(t?t:u)},title:w});return r},CELLREF:function(r){return(this.jS.spreadsheets[r]?this.jS.spreadsheets[r]:"Cell Reference Not Found")},CALCTIME:function(u,s){u=u||"";s=s||"";var r=this,t=this.jS;this.jS.s.parent.one("sheetCalculation",function(){t.time.last=t.calcLast;r.td.text(u+t.time.diff()+s)});return""},HLOOKUP:function(y,w,v,s){var x=this.jS,u=this.jS.cellLookup.call(this),r={html:"#N/A",value:""};v=v||1;s=s!==undefined?s:true;if(isNaN(y)){var t=w[0].indexOf(y);if(t>-1){r=x.updateCellValue(u[t].sheet,v,x.getTdLocation(u[t].td).col)}}else{f.getClosestNum(y,w[0],function(B,A){var z=x.updateCellValue(u[A].sheet,v,x.getTdLocation(u[A].td).col);if(s){r=z}else{if(z==y){r=z}}})}return r},VLOOKUP:function(y,w,v,s){var x=this.jS,u=this.jS.cellLookup.call(this),r={html:"#N/A",value:""};s=s!==undefined?s:true;if(isNaN(y)){var t=w[0].indexOf(y);if(t>-1){r=x.updateCellValue(u[t].sheet,v,x.getTdLocation(u[t].td).col)}}else{f.getClosestNum(y,w[0],function(B,A){var z=x.updateCellValue(u[A].sheet,x.getTdLocation(u[A].td).row,v);if(s){r=z}else{if(z==y){r=z}}})}return r},THISROWCELL:function(r){var s=this.jS,t=s.getTdLocation(this.td);if(isNaN(r)){r=d.columnLabelIndex(r)}return s.updateCellValue(this.sheet,t.row,r)},THISCOLCELL:function(t){var r=this.jS,s=r.getTdLocation(this.td);return r.updateCellValue(this.sheet,t,s.col)}};var p={BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,ALT:18,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,C:67,F:70,V:86,X:88,Y:89,Z:90};var f=k.arrHelpers={math:c,toNumbers:function(r){r=this.flatten(r);var s=r.length-1;if(s<0){return[]}do{if(r[s]){r[s]=i.trim(r[s]);if(isNaN(r[s])){r[s]=0}else{r[s]=r[s]*1}}else{r[s]=0}}while(s--);return r},unique:function(r){var t=[],s=r.length;for(var v=0;v<s;v++){for(var u=v+1;u<s;u++){if(r[v]===r[u]){u=++v}}t.push(r[v])}return t},flatten:function(r){var v=[];for(var t=0,s=r.length;t<s;t++){var u=Object.prototype.toString.call(r[t]).split(" ").pop().split("]").shift().toLowerCase();if(u){v=v.concat(/^(array|collection|arguments|object)$/.test(u)?this.flatten(r[t]):r[t])}}return v},insertAt:function(r,t,s){i(t).each(function(){if(s>-1&&s<=r.length){r.splice(s,0,this)}});return r},closest:function(v,s,t,r){v=v||[];s=s||0;t=t||0;r=r||v.length-1;var u;while(true){u=((t+r)>>1);if(u===r||u===t){return v[u]}if(v[u]>s){r=u}else{if(v[u]<s){t=u}else{return v[u]}}}},getClosestNum:function(t,r,v){var u=0,s,y,x,w;if(r.length){y=r[0];s=u;for(u;u<r.length;u++){x=c.abs(t-y);w=c.abs(t-r[u]);if(w<x){s=u;y=r[u]}x=null;w=null}if(v){return v(y,s)}return y}return false}};var b={dayDiv:86400000,math:c,toCentury:function(r,s){s=s||86400000;return this.math.round(this.math.abs((new m(1900,0,-1))-r)/s)},get:function(s,t){t=t||86400000;if(s.getMonth){return s}else{if(isNaN(s)){return new m(Globalize.parseDate(s))}else{s*=t;var r=(new m(1900,0,-1))*1;s+=r;s=new m(s);return s}}},week:function(r,t){t=t||86400000;var s=new m(r.getFullYear(),0,1);return this.math.ceil((((r-s)/t)+s.getDay()+1)/7)},toString:function(r,s){if(!s){return Globalize.format(r)}return Globalize.format(r,Globalize.culture().calendar.patterns[s])},diff:function(v,s,u,t){t=t||86400000;switch(u){case 0:return this.days360Nasd(v,s,0,true);case 1:case 2:case 3:var r=this.math.abs(s-v)/t;return r;case 4:return this.days360Euro(v,s)}return 0},diffMonths:function(t,s){var r;r=(s.getFullYear()-t.getFullYear())*12;r-=t.getMonth()+1;r+=s.getMonth()+1;return r},days360:function(t,w,u,s,r,v){return((w-t)*360)+((s-u)*30)+(v-r)},days360Nasd:function(s,v,r,t){var u=s.getDate(),z=s.getMonth(),y=s.getFullYear(),x=v.getDate(),w=v.getMonth(),A=v.getFullYear();if((w==2&&this.isEndOfMonth(x,w,A))&&((z==2&&this.isEndOfMonth(u,z,y))||r==3)){x=30}if(x==31&&(u>=30||r==3)){x=30}if(u==31){u=30}if(t&&z==2&&this.isEndOfMonth(u,z,y)){u=30}return this.days360(y,A,z,w,u,x)},days360Euro:function(y,t){var r=y.getDate(),v=y.getMonth(),u=y.getFullYear(),w=t.getDate(),s=t.getMonth(),x=t.getFullYear();if(r==31){r=30}if(w==31){w=30}return this.days360(u,x,v,s,r,w)},isEndOfMonth:function(r,t,s){return r==(new m(s,t+1,0,23,59,59)).getDate()},isLeapYear:function(r){return new m(r,1,29).getMonth()==1},calcAnnualBasis:function(r,t,x){switch(x){case 0:case 2:case 4:return 360;case 3:return 365;case 1:var s=r.getDate(),z=r.getMonth(),w=r.getFullYear(),u=t.getDate(),v=t.getMonth(),A=t.getFullYear(),B=0;if(w==A){if(this.isLeapYear(w)){B=366}else{B=365}}else{if(((A-1)==w)&&((z>v)||((z==v)&&s>=u))){if(this.isLeapYear(w)){if(z<2||(z==2&&s<=29)){B=366}else{B=365}}else{if(this.isLeapYear(A)){if(v>2||(v==2&&u==29)){B=366}else{B=365}}else{B=365}}}else{for(var y=w;y<=A;y++){if(this.isLeapYear(y)){B+=366}else{B+=365}}B=B/(A-w+1)}}return B}return 0},lastDayOfMonth:function(r){r.setDate(0);return r.getDate()},isLastDayOfMonth:function(r){return(r.getDate()==this.lastDayOfMonth(r))}};var a=k.times={math:c,fromMath:function(t){var r={},s=this;r.hour=((t*24)+"").split(".")[0]*1;r.minute=function(u){u=s.math.round(u*24*100)/100;u=(u+"").split(".");var v=0;if(u[1]){if(u[1].length<2){u[1]+="0"}v=u[1]*0.6}return s.math.round(v)}(t);r.second=function(x){x=s.math.round(x*24*10000)/10000;x=(x+"").split(".");var v=0;if(x[1]){for(var w=0;w<4;w++){if(!x[1].charAt(w)){x[1]+="0"}}var u=((x[1]*0.006)+"").split(".");if(u[1]){if(u[1]&&u[1].length>2){u[1]=u[1].substr(0,2)}return s.math.round(u[1]*0.6)}}return v}(t);return r},fromString:function(t,x){var u=new m(),y=t,r,w,v,s,z;if(x){z=y.substr(-2).toLowerCase();y=y.replace(/(am|pm)/i,"")}y=y.split(":");w=y[0]*1;v=y[1]*1;s=(y[2]?y[2]:0)*1;if(x&&z=="pm"){w+=12}return e.TIME(w,v,s)}};i.extend(c,{log10:function(r){return c.log(r)/2.302585092994046},signum:function(r){return(r/c.abs(r))||r},log1p:function(r){var s=0,u=50;if(r<=-1){return"-INF"}if(r<0||r>1){return c.log(1+r)}for(var t=1;t<u;t++){if((t%2)===0){s-=c.pow(r,t)/t}else{s+=c.pow(r,t)/t}}return s}});i.print=function(t){var r=win.open();r.document.write("<html><body><xmp>"+t+"\n</xmp></body></html>");r.document.close()};if(!Object.getPrototypeOf){Object.getPrototypeOf=function(r){return r||{}}}if(!Array.prototype.indexOf){i.sheet.max=60;Array.prototype.indexOf=function(t,u){for(var s=(u||0),r=this.length;s<r;s++){if(this[s]===t){return s}}return -1}}return h})(jQuery,document,window,Date,String,Number,Boolean,Math,RegExp,Error);